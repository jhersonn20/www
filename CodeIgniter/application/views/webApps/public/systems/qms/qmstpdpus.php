<div id="isoLookUp">
	<div class="wrap-grid demo-section" style="width: 100%;margin-left: 0;height: auto;">
	        <div id="isoStruc_grid"></div>
	</div>
	<div class="wrap-button demo-section">
		<div class="buttonLeft">
        	<button class="k-button mainEve" id="okButt">Ok</button>
        	<button class="k-button mainEve" id="cancelButt">Cancel</button>
       	</div>
    </div>
</div>

<div id="batchUpdate2">
	<div style="margin-bottom: 5px;">
	    <div class="wrap-form demo-section apply8" style="width: 37.1%;float:right;display: block;">
			
				<ul class="formLeft_qms" style="width: 100%;">
					<li>
						<label class="title" for="txt8" style="width: 150px;">Haul Delivery Date:</label><input type="text" name="txt8" id="txt8" style="width: 155px;text-align: right;"/>
					</li>
					<li>
						<label class="title" for="txt9" style="width: 150px;">Chipping F'Dn Date:</label><input type="text" name="txt9" id="txt9" style="width: 155px;text-align: right;"/>
					</li>
					<li>
						<label class="title" for="txt10" style="width: 150px;">Packer Plate Date:</label><input type="text" name="txt10" id="txt10" style="width: 155px;text-align: right;"/>
					</li>
					<li>
						<label class="title" for="txt11" style="width: 150px;">Pre-Assembly Date:</label><input type="text" name="txt11" id="txt11" style="width: 155px;text-align: right;"/>
					</li>
					<li>
						<label class="title" for="txt12" style="width: 150px;">Erection Date:</label><input type="text" name="txt12" id="txt12" style="width: 155px;text-align: right;"/>
					</li>
					<li>
						<label class="title" for="txt13" style="width: 150px;">Alignment Date:</label><input type="text" name="txt13" id="txt13" style="width: 155px;text-align: right;"/>
					</li>
					<li>
						<label class="title" for="txt14" style="width: 150px;">Bolt Lightning Date:</label><input type="text" name="txt14" id="txt14" style="width: 155px;text-align: right;"/></li>
					</li>
					
					
				</ul>
			
		</div>
	    <div class="wrap-grid demo-section" style="width: 58%;margin-left: 0;min-height: 240px;">
	        <div id="ttisoStruc_grid"></div>
	    </div>
	    <div class="wrap-button demo-section">
		<div class="buttonLeft">
        	<button class="k-button mainEve" id="insertButt">Insert</button>
        	<button class="k-button mainEve" id="delButt">Remove</button>
       	</div>
		<div class="buttonRight">
			<button class="k-button mainEve" id="updButt">Update</button>
        	<button class="k-button mainEve" id="cancelButt2">Cancel</button>
       	</div>				
	</div>
	</div>
</div>

<div id="batchUpdate">
	<div>
		<ul >
			<li><label class="title" for="plant_no">Plant No:</label><input name="plant_no" disabled="true" class="k-input k-textbox" style="text-align: left;width: 177px;"
	                        id="plant_no" data-bind="value:plant_no" />
				<label class="title" for="txt1" style="width: 150px;">Haul Delivery Date:</label><input type="text" name="txt1" id="txt1" style="width: 155px;text-align: right;"/></li>
	        <li><label class="title" for="area_no">Area No:</label><input name="area_no" disabled="true" class="k-input k-textbox" style="text-align: left;width: 177px;"
	                        id="area_no" data-bind="value:area_no" />
				<label class="title" for="txt2" style="width: 150px;">Chipping F'Dn Date:</label><input type="text" name="txt2" id="txt2" style="width: 155px;text-align: right;"/></li>
	        <li><label class="title" for="area_sub">Area Sub:</label><input name="area_sub" disabled="true" class="k-input k-textbox" style="text-align: left;width: 177px;"
	                        id="area_sub" data-bind="value:area_sub" />
				<label class="title" for="txt3" style="width: 150px;">Packer Plate Date:</label><input type="text" name="txt3" id="txt3" style="width: 155px;text-align: right;"/></li>
	        <li><label class="title" for="area_loc">Area Loc:</label><input name="area_loc" disabled="true" class="k-input k-textbox" style="text-align: left;width: 177px;"
	                        id="area_loc" data-bind="value:area_loc" />
				<label class="title" for="txt4" style="width: 150px;">Pre-Assembly Date:</label><input type="text" name="txt4" id="txt4" style="width: 155px;text-align: right;"/></li>
	        <li><label class="title" for="drawing_no">FAB DWG No:</label><input name="drawing_no" disabled="true" class="k-input k-textbox" style="text-align: left;width: 177px;"
	                        id="drawing_no" data-bind="value:drawing_no" />
				<label class="title" for="txt5" style="width: 150px;">Erection Date:</label><input type="text" name="txt5" id="txt5" style="width: 155px;text-align: right;"/></li>
	        <li><label class="title" for="sheet_no">Sheet No:</label><input name="sheet_no" disabled="true" class="k-input k-textbox" style="text-align: left;width: 177px;"
	                        id="sheet_no" data-bind="value:sheet_no" />
				<label class="title" for="txt6" style="width: 150px;">Alignment Date:</label><input type="text" name="txt6" id="txt6" style="width: 155px;text-align: right;"/></li>
			<li><label class="title" for="rev_no">Rev No:</label><input name="rev_no" disabled="true" class="k-input k-textbox" style="text-align: left;width: 177px;"
	                        id="rev_no" data-bind="value:rev_no" />
				<label class="title" for="txt7" style="width: 150px;">Bolt Lightning Date:</label><input type="text" name="txt7" id="txt7" style="width: 155px;text-align: right;"/></li>
	        
			
			
		</ul>
		
	</div>	
	<div class="buttonRight">
			<button class="k-button mainEve" id="saveButt">Save</button>
        	<button class="k-button mainEve" id="closeWindow">Cancel</button>
    </div>	
	
</div>


<div id="main-wrapper">
	<div style="min-height: 198px;margin-bottom: 5px;">
	    <div class="wrap-grid demo-section" style="width: 100%;margin-left: 0;height: auto;">
	        <div id="rowSelection"></div>
	    </div>
	</div>
	<div class="wrap-button demo-section" style="width: 100%">
		<div class="buttonLeft">
			<button class="k-button mainEve" id="exportButt">Export</button>
		</div>
		<div class="buttonRight">
        	<button class="k-button mainEve" id="batchUpdateButt">Batch Update</button>
       	</div>	
	</div>
	<div style="min-height: 198px;margin-bottom: 5px;">
	    <div class="wrap-grid demo-section" style="width: 100%;margin-left: 0;height: auto;">
	        <div id="pieceStruct_grid"></div>
	    </div>
	</div>
	<div class="wrap-button demo-section">
		<div class="buttonLeft">
			<button class="k-button" id="saveButt2">Save</button>
	        	<button class="k-button" id="cancelButt2">Cancel</button>
        	<button class="k-button mainEve" id="editButt">Edit</button>
        	<button class="k-button mainEve" id="quickUpdate">Quick Update</button>
       	</div>
		<div class="buttonRight">
			<button class="k-button mainEve" id="printButt">Print</button>
        	<button class="k-button mainEve" id="closeButt">Close</button>
       	</div>				
	</div>
	
</div>
<script type="text/javascript">
	function grid_change(e){
		if (typeof e == "undefined")
			e = grid;
	    var selectedRows = e.select();
	    var selectedDataItems = [];
	    for (var i = 0; i < selectedRows.length; i++) {
	      dataItem = e.dataItem(selectedRows[i]);
	      
	      
		    // // $("#txt1").val(dataItem.disc_code);
		    // // $("#textarea").val(dataItem.disc_desc);
		    // // $("#rad1").prop("checked",(dataItem.flg_status == 1));
		    // // $("#rad2").prop("checked",(dataItem.flg_status != 1));
		    // // $("#txt2").val(dataItem.log_user);
			// // $("#txt3").val(kendo.toString(dataItem.log_date,'MM/dd/yyyy'));
			// // $("#txt4").val(dataItem.log_update);
			$(plant_no).val(dataItem.plant_no);	
			$(area_no).val(dataItem.area_no);
			$(area_sub).val(dataItem.area_sub);
			$(area_loc).val(dataItem.area_loc);
			$(drawing_no).val(dataItem.drawing_no);
			$(sheet_no).val(dataItem.sheet_no);
			$(rev_no).val(dataItem.rev_no);
			
	    }   
	}
	function forDiv(){
		var container = $("#rowSelection");
		var position = container.offset();	
		var offsetHeight = container.height();	
		var offsetWidth = container.width();
		var newDiv = $("<div id = 'coverDiv'>").appendTo($("body"));
		newDiv.offset(position);
		newDiv.height(offsetHeight);	
		newDiv.width(offsetWidth - 17);
	}
	$(document).ready(function(){
		$("body").css({"background": "url('/assets/images/webapps/<?php echo $system; ?>_bg_blur_1.jpg') no-repeat fixed center top #222", "background-size": "100% 100%"});
		var crudService = crudServiceBaseUrl + "qms/index/", isFailed = false,
		    filterFArr = [], filterOArr = [], filterVArr = [], sentValue = "", currRow = "", dataItem = "",
        	filterFArr_pieceStruct = [], filterOArr_pieceStruct = [], filterVArr_pieceStruct = [], currRow2 = "", pieceStruct_di = '', 
        	filterFArr_ttisoStruc = [], filterOArr_ttisoStruc = [], filterVArr_ttisoStruc = [], currRow3 = "", ttisoStruc_di = '', 
        	filterFArr_isoStruc = [], filterOArr_isoStruc = [], filterVArr_isoStruc = [], currRow4 = "", isoStruc_di = '',
        	cMode = "", fieldSort = "", dirSort = "";
        
        $("#saveButt2 ,#cancelButt2").hide();
        	// -- DATEPICKER -- //
        $("#txt1,#txt2,#txt3,#txt4,#txt5,#txt6,#txt7,#txt8,#txt9,#txt10,#txt11,#txt12,#txt13,#txt14").kendoDatePicker()
																                                .closest(".k-widget")
																                                .attr("id", "datepicker_wrapper");
											        
        var dateHaul = $("#txt1").data("kendoDatePicker");
		var dateChipping = $("#txt2").data("kendoDatePicker");
		var datePacker = $("#txt3").data("kendoDatePicker");
		var datePre = $("#txt4").data("kendoDatePicker");
		var dateErection = $("#txt5").data("kendoDatePicker");
		var dateAlignment = $("#txt6").data("kendoDatePicker");
		var dateBolt = $("#txt7").data("kendoDatePicker");
		
		var dateHaul2 = $("#txt8").data("kendoDatePicker");
		var dateChipping2 = $("#txt9").data("kendoDatePicker");
		var datePacker2 = $("#txt10").data("kendoDatePicker");
		var datePre2 = $("#txt11").data("kendoDatePicker");
		var dateErection2 = $("#txt12").data("kendoDatePicker");
		var dateAlignment2 = $("#txt13").data("kendoDatePicker");
		var dateBolt2 = $("#txt14").data("kendoDatePicker");
        	
        	// -- Window Grid -- //
        	
         $("#batchUpdate").kendoWindow({ 
            width: "1000px",
            height: "auto",
            title: "Batch Update",
            modal: true,
            visible: false,
            resizable: false,
            scrollable: true,
            open: function(){
            	//console.log(this);
            }
        });
        
        $("#batchUpdate2").kendoWindow({ 
            width: "1000px",
            height: "300px",
            title: "Quick Update",
            modal: true,
            visible: false,
            resizable: false,
            scrollable: true,
            open: function(){
            	//console.log(this);
            }
        });
        
        $("#isoLookUp").kendoWindow({ 
            width: "1000px",
            height: "auto",
            title: "Structural Drawing Help List",
            modal: true,
            visible: false,
            resizable: false,
            scrollable: true,
            open: function(){
            	//console.log(this);
            }
        });
        
        	// -- iso struct grid -- //
        	
        var dataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: crudService + "directCall/isoStruc",
                    contentType: "application/json",
                    type: "GET"
                },
                create: {
                    url: crudService + "manage/isoStruc",
                    type: "POST",
	                complete: function(jqXHR, textStatus) {
	                	console.log(jqXHR);
	                	if (jqXHR.responseText != '1')
							showNotif('Warning',jqXHR.responseText,'warning');
							else
							{$("#rowSelection").data("kendoGrid").setDataSource(dataSource);
							$("#rowSelection").data("kendoGrid").dataSource.page($("#rowSelection").data("kendoGrid").dataSource.page());
							$("#rowSelection").data("kendoGrid").dataSource.read();
							}
	                }
                },
                update: {
                    url: crudService + "manage/isoStruc",
                    type: "POST"
                },
                destroy: {
                    url: crudService + "remove/isoStruc",
                    type: "POST"
                },
			    parameterMap: function(data, type) {
			      if (type == "read") {
			      	if ($(data.filter).length > 0){
				      	$.each(data.filter.filters,function(index,value){
				      		var valForm = ((typeof this.value) == "object") ? kendo.toString(this.value,"yyyy-MM-dd") : this.value;
				      		filterFArr[index] = this.field + ";" + valForm + ";" + this.operator;
				      		filterOArr[index] = this.operator;
				      		filterVArr[index] = valForm;
				      	});
				    }
				    fieldSort = ($(data.sort).length ? data.sort[0].field : "plant_no");
				    query = filterFArr;
				    dirSort = ($(data.sort).length ? data.sort[0].dir : "desc")
			        return {
			            page: data.page,
			            pageSize: data.pageSize,
			            top: data.take,
			            skip: data.skip,
					    fieldF: filterFArr,
					    fieldS: ($(data.sort).length ? data.sort[0].field : "plant_no"),
					    operator: (($(data.filter).length > 0) ? filterOArr : "contains"),
					    value: (($(data.filter).length > 0) ? filterVArr : sentValue),
					    dir: ($(data.sort).length ? data.sort[0].dir : "asc")
					   
			        }
			      }else {
			      	  // data['log_user'] = $("#hidden_user").val();
			      	  // return data;
			      }
			    }
            },
			requestEnd: function(e) {
			    var response = e.response;
			    var type = e.type;
			    // console.log(type);
			    // console.log(response);
			},
            pageSize: 10,
            serverPaging: true,
			serverFiltering: true,
			serverSorting: true,
            schema: {
                data: function(data) {
                    return data.rows || [];
                },
                errors: function(data){
               	    if (filterFArr.length > 0 && $(data.rows).length == 0){
               		    notif("info","Information","No records found!");
					    sentValue = "";
					    filterFArr = [];
					    $("form.k-filter-menu button[type='reset']").trigger("click");
               	    }
                },
                model: {
               		id: "PROGRESS_RECID",
                    fields: {
                   	    PROGRESS_RECID: { type: "number", editable: false },
                   	    plant_no: { type: "string" },
                        area_no: { type: "string" },
                        area_sub: { type: "string" },
                        area_loc: { type: "string" },
                        drawing_no: { type: "string" },
                        sheet_no: { type: "string" },
                        rev_no: { type: "string" },
                        rack_no: { type: "string" },
                        prior_no: { type: "string" },
                        supp_code: { type: "string" }
                       
                    }
                },
                total: function(response) {
				   	return (($(response.rows[0]).length > 0) ? response.rows[0].total : 0); //$(response.rows).length;				   	
			    }
            },
            change: function(e) {
            	if ($(e.items).length == 0)
            		return true;
            }
        });
                                
	    var addExtraStylingToGrid = function () {
			$("#rowSelection").data("kendoGrid").select("tr:eq(1)");
	        $(".k-grid-content > table > tbody > tr").hover(
	            function() {
	                $(this).toggleClass("k-state-hover");
	            }			        
	        );
        	filterFArr = [];
	    };
        
        var grid = $("#rowSelection").kendoGrid({
            dataSource: dataSource,
            selectable: "row",
            pageable: {
                buttonCount: 3,
    			input: true
            },
            groupable: false,
            sortable: true,
            scrollable: true,
            navigatable: true,
            editable: false,
            resizable: true,
            filterable: {
                extra: false
            },
            columns: [
               {field: "plant_no",title: "Plant No",width: 90},
               {field: "area_no",title: "Area No",width: 90},
               {field: "area_sub",title: "Area Sub",width: 102},
               {field: "area_loc",title: "Area Loc",width: 90},
               {field: "drawing_no",title: "FAB Drawing No",width: 132},
               {field: "sheet_no",title: "Sheet No"},
               {field: "rev_no",title: "Rev No",width: 102},
               {field: "rack_no",title: "Structural ID",width: 120},
               {field: "prior_no",title: "Priority",width: 102},
               {field: "supp_code",title: "Vendor",width: 90}
               
           ],
           change: function(e){
           		currRow = this;
			    var selectedRows = this.select();
			    var selectedDataItems = [];
			    for (var i = 0; i < selectedRows.length; i++) {
			        dataItem = this.dataItem(selectedRows[i]);
			        pieceStruct_ds.read();
			    }
			    grid_change(currRow);
           },
           dataBound: addExtraStylingToGrid
        });
        insertGridTitle("#rowSelection", "Structural Drawing Listing");
        
        // -- piece struct grid -- //
        
         var pieceStruct_ds = new kendo.data.DataSource({
            transport: {
                read: {
                    url: crudService + "directCall/pieceStruc",
                    contentType: "application/json",
                    type: "GET"
                },
                create: {
                    url: crudService + "manage/updPieceStruct",
                    type: "POST"
	                // complete: function(jqXHR, textStatus) {
	                	// console.log(jqXHR);
	                	// if (jqXHR.responseText != '1')
							// showNotif('Warning',jqXHR.responseText,'warning');
							// else
							// {
							// $("#rowSelection").data("kendoGrid").setDataSource(dataSource);
							// $("#rowSelection").data("kendoGrid").dataSource.page($("#rowSelection").data("kendoGrid").dataSource.page());
							// $("#rowSelection").data("kendoGrid").dataSource.read();
							// }
	                // }
                },
                update: {
                    url: crudService + "manage/updPieceStruct",
                    type: "POST"
                     // complete: function(jqXHR, textStatus) {
						 // showNotif('Warning',jqXHR.responseText,'warning');		
                	 // }
                },
                destroy: {
                    url: crudService + "remove/UpdatePieceStruct",
                    type: "POST"
                },
			    parameterMap: function(data, type) {
			      if (type == "read") {
			      	if ($(data.filter).length > 0){
				      	$.each(data.filter.filters,function(index,value){
				      		var valForm = ((typeof this.value) == "object") ? kendo.toString(this.value,"yyyy-MM-dd") : this.value;
				      		filterFArr_pieceStruct[index] = this.field + ";" + valForm + ";" + this.operator;
				      		filterOArr_pieceStruct[index] = this.operator;
				      		filterVArr_pieceStruct[index] = valForm;
				      	});
				    }
				    fieldSort = ($(data.sort).length ? data.sort[0].field : "piece_no");
				    query = filterFArr_pieceStruct;
				    dirSort = ($(data.sort).length ? data.sort[0].dir : "asc")
			        return {
			            page: data.page,
			            pageSize: data.pageSize,
			            top: data.take,
			            skip: data.skip,
					    fieldF: filterFArr_pieceStruct,
					    fieldS: ($(data.sort).length ? data.sort[0].field : "piece_no"),
					    operator: (($(data.filter).length > 0) ? filterOArr_pieceStruct : "contains"),
					    value: (($(data.filter).length > 0) ? filterVArr_pieceStruct : sentValue),
					    dir: ($(data.sort).length ? data.sort[0].dir : "asc"),
					    plant_no : dataItem.plant_no,
					    area_no : dataItem.area_no,
					    area_loc : dataItem.area_loc,
					    drawing_no : dataItem.drawing_no,
					    sheet_no : dataItem.sheet_no,
					    rev_no : dataItem.rev_no
					    
			        }
			      }else {
			      	 data['log_user'] = $("#hidden_user").val();
			      	 data['plan_delv_dt'] = kendo.toString(data['plan_delv_dt'],"yyyy-MM-dd");
			      	 data['chip_fdn_dt'] = kendo.toString(data['chip_fdn_dt'],"yyyy-MM-dd");
			      	 data['packer_plate_dt'] = kendo.toString(data['packer_plate_dt'],"yyyy-MM-dd");
			      	 data['assembly_dt'] =  kendo.toString(data['assembly_dt'],"yyyy-MM-dd");
			      	 data['erection_dt'] =  kendo.toString(data['erection_dt'],"yyyy-MM-dd");
			      	 data['alignment_dt'] =  kendo.toString(data['alignment_dt'],"yyyy-MM-dd");
			      	 data['bolt_avail_dt'] =  kendo.toString(data['bolt_avail_dt'],"yyyy-MM-dd");
			      	 data['received_dt'] =  kendo.toString(data['received_dt'],"yyyy-MM-dd");
			      	 data['issued_dt'] =  kendo.toString(data['issued_dt'],"yyyy-MM-dd");
			      	 data['pcd_haul'] =  kendo.toString(data['pcd_haul'],"yyyy-MM-dd");
			      	 data['pcd_chip'] =  kendo.toString(data['pcd_chip'],"yyyy-MM-dd");
			      	 data['pcd_packer'] =  kendo.toString(data['pcd_packer'],"yyyy-MM-dd");
			      	 data['pcd_pre_a'] =  kendo.toString(data['pcd_pre_a'],"yyyy-MM-dd");
			      	 data['pcd_erect'] =  kendo.toString(data['pcd_erect'],"yyyy-MM-dd");
			      	 data['pcd_align'] =  kendo.toString(data['pcd_align'],"yyyy-MM-dd");
			      	 data['pcd_bolt'] =  kendo.toString(data['pcd_bolt'],"yyyy-MM-dd");
			      	  return data;

			      }
			    }
            },
			requestEnd: function(e) {
			    var response = e.response;
			    var type = e.type;
			    // console.log(type);
			    // console.log(response);
			},
            pageSize: 10,
            serverPaging: true,
			serverFiltering: true,
			serverSorting: true,
            schema: {
                data: function(data) {
                    return data.rows || [];
                },
                errors: function(data){
               	    if (filterFArr_pieceStruct.length > 0 && $(data.rows).length == 0){
               		    notif("info","Information","No records found!");
					    sentValue = "";
					    filterFArr_pieceStruct = [];
					    $("form.k-filter-menu button[type='reset']").trigger("click");
               	    }
                },
                model: {
               		id: "PROGRESS_RECID",
                    fields: {
                   	    PROGRESS_RECID: { type: "number", editable: false },
                        piece_no: { type: "string",editable:false },
                        piece_desc: { type: "string",editable:false },
                        location: { type: "string",editable:false },
                        elevation: { type: "string",editable:false },
                        qty: { type: "string",editable:false },
                        length: { type: "string",editable:false },
                        weight: { type: "string",editable:false },
                        um: { type: "string",editable:false  },
                        workable_pct: { type: "string",editable:false  },
                        reqd_qty: { type: "string",editable:false  },
                        received_dt: { type: "date",editable:false, format: "{0:MM/dd/yyyy}" },
                        issued_dt: { type: "date",editable:false, format: "{0:MM/dd/yyyy}" },
                        plan_delv_dt: { type: "date",type: "date",editable:true, format: "{0:MM/dd/yyyy}" },
                        chip_fdn_dt: { type: "date",editable:true, format: "{0:MM/dd/yyyy}" },
                        packer_plate_dt: { type: "date",editable:true, format: "{0:MM/dd/yyyy}" },
                        assembly_dt: { type: "date",editable:true, format: "{0:MM/dd/yyyy}" },
                        erection_dt: { type: "date",editable:true, format: "{0:MM/dd/yyyy}" },
                        alignment_dt: { type: "date",editable:true, format: "{0:MM/dd/yyyy}" },
                        bolt_avail_dt: { type: "date",editable:true, format: "{0:MM/dd/yyyy}" },
                        wrk_remarks: { type: "string",editable:false },
                        pcd_haul: { type: "date",editable:false },
                        pcd_chip: { type: "date" ,editable: false },
                        pcd_packer: { type: "date",editable: false },
                        pcd_pre_a: { type: "date",editable: false  },
                        pcd_erect: { type: "date",editable: false  },
                        pcd_align: { type: "date",editable: false  },
                        pcd_bolt: { type: "date",editable: false  }
                    }
                },
                total: function(response) {
				   	return (($(response.rows[0]).length > 0) ? response.rows[0].total : 0); //$(response.rows).length;				   	
			    }
            },
            change: function(e) {
            	if ($(e.items).length == 0)
            		return true;
            }
        });
                                
	    var addExtraStylingToGrid2 = function () {
			$("#pieceStruct_grid").data("kendoGrid").select("tr:eq(" + (dataSource._data.length + 2) + ")");
	        $(".k-grid-content > table > tbody > tr").hover(
	            function() {
	                $(this).toggleClass("k-state-hover");
	            }			        
	        );
        	filterFArr_pieceStruct = [];
	    };
        
        var grid2 = $("#pieceStruct_grid").kendoGrid({
            dataSource: pieceStruct_ds,
            selectable: "row",
            pageable: {
                buttonCount: 5,
    			input: true
            },
            autobind: true,
            groupable: false,
            sortable: true,
            scrollable: true,
            navigatable: true,
            editable: "inline",
            resizable: true,
            toolbar: ["save","cancel"],
            filterable: {
                extra: false
            },
            columns: [
               {field: "piece_no",title: "Piece No",width: 120},
               {field: "piece_desc",title: "Piece Desc",width: 120},
               {field: "location",title: "Location",width: 102},
               {field: "elevation",title: "Elevation",width: 120},
               {field: "qty",title: "Quantity",width: 132},
               {field: "length",title: "Length",width: 102},
               {field: "weight",title: "Weight",width: 102},
               {field: "um",title: "UM",width: 120},
               {field: "workable_pct",title: "Workable PCT",width: 130},
               {field: "reqd_qty",title: "Required Qty",width: 120},
               {field: "received_dt",title: "Received Date",width: 120,format: "{0:MM/dd/yyyy}"},
               {field: "issued_dt",title: "Issued Date",width: 120,format: "{0:MM/dd/yyyy}"},
               {field: "plan_delv_dt",title: "Haul Delivery Date",width: 155,format: "{0:MM/dd/yyyy}"},
               {field: "chip_fdn_dt",title: "Chipping FDN Date",width: 155,format: "{0:MM/dd/yyyy}"},
               {field: "packer_plate_dt",title: "Packer Plate Date",width: 152,format: "{0:MM/dd/yyyy}"},
               {field: "assembly_dt",title: "Pre-Assembly Date",width: 152,format: "{0:MM/dd/yyyy}"},
               {field: "erection_dt",title: "Erection Date",width: 132,format: "{0:MM/dd/yyyy}"},
               {field: "alignment_dt",title: "Alignment Date",width: 120,format: "{0:MM/dd/yyyy}"},
               {field: "bolt_avail_dt",title: "Bolt Tightening Date",width: 152,format: "{0:MM/dd/yyyy}"},
               {field: "wrk_remarks",title: "Remarks",width: 120},
               {field: "pcd_haul",title: "PCD Haul",width: 120,format: "{0:MM/dd/yyyy}"},
               {field: "pcd_chip",title: "PCD Chip",width: 120,format: "{0:MM/dd/yyyy}"},
               {field: "pcd_packer",title: "PCD Packer",width: 102,format: "{0:MM/dd/yyyy}"},
               {field: "pcd_pre_a",title: "PCD Pre-A",width: 120,format: "{0:MM/dd/yyyy}"},
               {field: "pcd_erect",title: "PCD Erect",width: 132,format: "{0:MM/dd/yyyy}"},
               {field: "pcd_align",title: "PCD Align",width: 102,format: "{0:MM/dd/yyyy}"},
               {field: "pcd_bolt",title: "PCD Bolt",width: 120,format: "{0:MM/dd/yyyy}"}
           ],
           change: function(e){
           		currRow2 = this;
			    var selectedRows = this.select();
			    var selectedDataItems = [];
			    for (var i = 0; i < selectedRows.length; i++) {
			        pieceStruct_di = this.dataItem(selectedRows[i]);
			    }
			   // grid_change(currRow);
           },
           dataBound: addExtraStylingToGrid2
        });
        insertGridTitle("#pieceStruct_grid","Piece Mark Listing");
          $("#pieceStruct_grid .k-grid-toolbar").hide();
         
          	// -- tt_iso struct grid -- //
        	
        var ttisoStruc_ds = new kendo.data.DataSource({
            transport: {
                read: {
                    url: crudService + "directCall/ttisoStruc",
                    contentType: "application/json",
                    type: "GET"
                },
                create: {
                    url: crudService + "manage/ttisoStruc",
                    type: "POST",
                     complete: function(jqXHR, textStatus) {
	                	console.log(jqXHR);
	                	if (jqXHR.responseText != '1')
							showNotif('Warning',jqXHR.responseText,'warning');
							else
							{
							$("#rowSelection").data("kendoGrid").setDataSource(dataSource);
							$("#rowSelection").data("kendoGrid").dataSource.page($("#rowSelection").data("kendoGrid").dataSource.page());
							$("#rowSelection").data("kendoGrid").dataSource.read();
							}
	                }
                },
                update: {
                    url: crudService + "manage/ttisoStruc",
                    type: "POST",
                    
                },
                destroy: {
                    url: crudService + "remove/ttisoStruc",
                    type: "POST",
                   
                },
			    parameterMap: function(data, type) {
			      if (type == "read") {
			      	if ($(data.filter).length > 0){
				      	$.each(data.filter.filters,function(index,value){
				      		var valForm = ((typeof this.value) == "object") ? kendo.toString(this.value,"yyyy-MM-dd") : this.value;
				      		filterFArr_ttisoStruc[index] = this.field + ";" + valForm + ";" + this.operator;
				      		filterOArr_ttisoStruc[index] = this.operator;
				      		filterVArr_ttisoStruc[index] = valForm;
				      	});
				    }
				    fieldSort = ($(data.sort).length ? data.sort[0].field : "plant_no") ;
				    query = filterFArr_ttisoStruc;
				    dirSort = ($(data.sort).length ? data.sort[0].dir : "desc")
			        return {
			            page: data.page,
			            pageSize: data.pageSize,
			            top: data.take,
			            skip: data.skip,
					    fieldF: filterFArr_ttisoStruc,
					    fieldS: ($(data.sort).length ? data.sort[0].field : "plant_no"),
					    operator: (($(data.filter).length > 0) ? filterOArr_ttisoStruc : "contains"),
					    value: (($(data.filter).length > 0) ? filterVArr_ttisoStruc : sentValue),
					    dir: ($(data.sort).length ? data.sort[0].dir : "asc")
					    // plant_no : dataItem.plant_no,
					    // area_no : dataItem.area_no,
					    // area_loc : dataItem.area_loc,
					    // drawing_no : dataItem.drawing_no,
					    // sheet_no : dataItem.sheet_no,
					    // rev_no : dataItem.rev_no
					   
			        }
			      }else {
			      
			      	  // data['log_user'] = $("#hidden_user").val();
			      	   return data;

			      }
			    }
            },
			requestEnd: function(e) {
			    var response = e.response;
			    var type = e.type;
			    // console.log(type);
			    // console.log(response);
			},
            pageSize: 5,
            serverPaging: true,
			serverFiltering: true,
			serverSorting: true,
            schema: {
                data: function(data) {
                    return data.rows || [];
                },
                errors: function(data){
               	    if (filterFArr_ttisoStruc.length > 0 && $(data.rows).length == 0){
               		    notif("info","Information","No records found!");
					    sentValue = "";
					    filterFArr_ttisoStruc = [];
					    $("form.k-filter-menu button[type='reset']").trigger("click");
               	    }
                },
                model: {
               		id: "PROGRESS_RECID",
                    fields: {
                   	    PROGRESS_RECID: { type: "number", editable: false },
                   	    plant_no: { type: "string" },
                        area_no: { type: "string" },
                        area_sub: { type: "string" },
                        area_loc: { type: "string" },
                        drawing_no: { type: "string" },
                        sheet_no: { type: "string" },
                        rev_no: { type: "string" },
                        rack_no: { type: "string" },
                        prior_no: { type: "string" },
                        supp_code: { type: "string" }
                       
                    }
                },
                total: function(response) {
				   	return (($(response.rows[0]).length > 0) ? response.rows[0].total : 0); //$(response.rows).length;				   	
			    }
            },
            change: function(e) {
            	if ($(e.items).length == 0)
            		return true;
            }
        });
                                
	    var addExtraStylingToGrid3 = function () {
			$("#ttisoStruc_grid").data("kendoGrid").select("tr:eq(1)");
	        $(".k-grid-content > table > tbody > tr").hover(
	            function() {
	                $(this).toggleClass("k-state-hover");
	            }			        
	        );
        	filterFArr_ttisoStruc = [];
	    };
        
        var grid3 = $("#ttisoStruc_grid").kendoGrid({
            dataSource: ttisoStruc_ds,
            selectable: "row",
            pageable: {
                buttonCount: 3,
    			input: true
            },
            autoBind: false,
            groupable: false,
            sortable: true,
            scrollable: true,
            navigatable: true,
            editable: false,
            resizable: true,
            filterable: {
                extra: false
            },
            columns: [
               {field: "plant_no",title: "Plant No",width: 90},
               {field: "area_no",title: "Area No",width: 90},
               {field: "area_sub",title: "Area Sub",width: 102},
               {field: "area_loc",title: "Area Loc",width: 90},
               {field: "drawing_no",title: "FAB Drawing No",width: 132},
               {field: "sheet_no",title: "Sheet No",width: 132},
               {field: "rev_no",title: "Rev No",width: 102},
               {field: "rack_no",title: "Structural ID",width: 120},
               {field: "prior_no",title: "Priority",width: 102},
               {field: "supp_code",title: "Vendor",width: 90}
               
           ],
           change: function(e){
           		currRow3 = this;
			    var selectedRows = this.select();
			    var selectedDataItems = [];
			    for (var i = 0; i < selectedRows.length; i++) {
			        ttisoStruc_di = this.dataItem(selectedRows[i]);
			        //pieceStruct_ds.read();
			    }
			    grid_change(currRow3);
           },
           dataBound: addExtraStylingToGrid3
        });
        insertGridTitle("#ttisoStruc_grid", "Drawing Listing");
        
		   	 // -- iso struc 2 grid -- //
        	
        var isoStruc_ds = new kendo.data.DataSource({
            transport: {
                read: {
                    url: crudService + "directCall/isoStruc",
                    contentType: "application/json",
                    type: "GET"
                },
			    parameterMap: function(data, type) {
			      if (type == "read") {
			      	if ($(data.filter).length > 0){
				      	$.each(data.filter.filters,function(index,value){
				      		var valForm = ((typeof this.value) == "object") ? kendo.toString(this.value,"yyyy-MM-dd") : this.value;
				      		filterFArr_isoStruc[index] = this.field + ";" + valForm + ";" + this.operator;
				      		filterOArr_isoStruc[index] = this.operator;
				      		filterVArr_isoStruc[index] = valForm;
				      	});
				    }
				    fieldSort2 = ($(data.sort).length ? data.sort[0].field : "t.plant_no,t.area_no,t.area_sub,t.rack_no,t.prior_no");
				    query2 = filterFArr_isoStruc;
				    dirSort2 = ($(data.sort).length ? data.sort[0].dir : "desc")
			        return {
			            page: data.page,
			            pageSize: data.pageSize,
			            top: data.take,
			            skip: data.skip,
					    fieldF: filterFArr_isoStruc,
					    fieldS: ($(data.sort).length ? data.sort[0].field : "plant_no"),
					    operator: (($(data.filter).length > 0) ? filterOArr_isoStruc : "contains"),
					    value: (($(data.filter).length > 0) ? filterVArr_isoStruc : sentValue),
					    dir: ($(data.sort).length ? data.sort[0].dir : "asc")
					   
			        }
			      }else {
			      	  // data['log_user'] = $("#hidden_user").val();
			      	  // return data;

			      }
			    }
            },
			requestEnd: function(e) {
			    var response = e.response;
			    var type = e.type;
			    // console.log(type);
			    // console.log(response);
			},
            pageSize: 10,
            serverPaging: true,
			serverFiltering: true,
			serverSorting: true,
            schema: {
                data: function(data) {
                    return data.rows || [];
                },
                errors: function(data){
               	    if (filterFArr_isoStruc.length > 0 && $(data.rows).length == 0){
               		    notif("info","Information","No records found!");
					    sentValue = "";
					    filterFArr_isoStruc = [];
					    $("form.k-filter-menu button[type='reset']").trigger("click");
               	    }
                },
                model: {
               		id: "PROGRESS_RECID",
                    fields: {
                   	    PROGRESS_RECID: { type: "number", editable: false },
                   	    plant_no: { type: "string" },
                        area_no: { type: "string" },
                        area_sub: { type: "string" },
                        area_loc: { type: "string" },
                        drawing_no: { type: "string" },
                        sheet_no: { type: "string" },
                        rev_no: { type: "string" },
                        rack_no: { type: "string" },
                        prior_no: { type: "string" },
                        supp_code: { type: "string" }
                       
                    }
                },
                total: function(response) {
				   	return (($(response.rows[0]).length > 0) ? response.rows[0].total : 0); //$(response.rows).length;				   	
			    }
            },
            change: function(e) {
            	if ($(e.items).length == 0)
            		return true;
            }
        });
                                
	    var addExtraStylingToGrid4 = function () {
			$("#isoStruc_grid").data("kendoGrid").select("tr:eq(1)");
	        $(".k-grid-content > table > tbody > tr").hover(
	            function() {
	                $(this).toggleClass("k-state-hover");
	            }			        
	        );
        	filterFArr_isoStruc = [];
	    };
        
        var grid4 = $("#isoStruc_grid").kendoGrid({
            dataSource: isoStruc_ds,
            selectable: "row",
            pageable: {
                buttonCount: 3,
    			input: true
            },
            groupable: false,
            sortable: true,
            scrollable: true,
            navigatable: true,
            editable: false,
            resizable: true,
            filterable: {
                extra: false
            },
            columns: [
               {field: "plant_no",title: "Plant No",width: 90},
               {field: "area_sub",title: "Area Sub",width: 102},
               {field: "area_loc",title: "Area Loc",width: 90},
               {field: "drawing_no",title: "Drawing No",width: 132},
               {field: "sheet_no",title: "Sheet No"},
               {field: "rev_no",title: "Rev No",width: 102},
               {field: "rack_no",title: "Structural ID",width: 120},
               {field: "prior_no",title: "Priority",width: 102}
               
           ],
           change: function(e){
           		currRow4 = this;
			    var selectedRows = this.select();
			    var selectedDataItems = [];
			    for (var i = 0; i < selectedRows.length; i++) {
			      isoStruc_di = this.dataItem(selectedRows[i]);
			    }
			    grid_change(currRow4);
           },
           dataBound: addExtraStylingToGrid
        });
        insertGridTitle("#isoStruc_grid", "Structural Drawing Listing Help");
        
        // -- event handler -- //
        
        var toggleButt = function(vis){
	        $.each($("#rowSelection .k-grid-toolbar").find("a"),function(index, value){
	        	eval("$(this)." + ((index <= 3) ? vis : ((vis == "show") ? "hide" : "show")) + "();")
	        });
	    }
	    toggleButt("show");
	    
	    $(".wrap-form input, .wrap-form textarea, .wrap-form button").prop("disabled", true).addClass("k-state-disabled");
	    $(".wrap-button .buttonLeft  button").bind({
	    	click: function(e){
	    		switch(this.id){
	    			case "okButt":
					//console.log(isoStruc_di.plant_no,isoStruc_di.area_no,isoStruc_di.area_sub,isoStruc_di.area_loc)
					
					$.post(crudService + "manage/ttisoStruc",{
																	PROGRESS_RECID_IDENT: 0,
																    PROGRESS_RECID: isoStruc_di.PROGRESS_RECID,
																	plant_no: isoStruc_di.plant_no,
																	area_no: isoStruc_di.area_no,
																	area_sub: isoStruc_di.area_sub,
																	area_loc: isoStruc_di.area_loc,
																	drawing_no: isoStruc_di.drawing_no,
																	sheet_no: isoStruc_di.sheet_no,
																	rev_no: isoStruc_di.rev_no,
																	rack_no: isoStruc_di.rack_no,
																	prior_no: isoStruc_di.prior_no,
																	supp_code: isoStruc_di.supp_code
																	},
					       	    function(data){
									$("#ttisoStruc_grid").data("kendoGrid").setDataSource(ttisoStruc_ds);
									$("#ttisoStruc_grid").data("kendoGrid").dataSource.page($("#ttisoStruc_grid").data("kendoGrid").dataSource.page());
									$("#ttisoStruc_grid").data("kendoGrid").dataSource.read();
					       	    });
					// ttisoStruc_ds.add({		PROGRESS_RECID_IDENT: 0,
										    // PROGRESS_RECID: isoStruc_di.PROGRESS_RECID,
											// plant_no: isoStruc_di.plant_no,
											// area_no: isoStruc_di.area_no,
											// area_sub: isoStruc_di.area_sub,
											// area_loc: isoStruc_di.area_loc,
											// drawing_no: isoStruc_di.drawing_no,
											// rev_no: isoStruc_di.rev_no,
											// rack_no: isoStruc_di.rack_no,
											// prior_no: isoStruc_di.prior_no,
											// supp_code: isoStruc_di.supp_code
										    // });
								// ttisoStruc_ds.sync();	
								$("#isoLookUp").data("kendoWindow").close();
							    $("#ttisoStruc_grid").data("kendoGrid").setDataSource(ttisoStruc_ds);
							    $("#ttisoStruc_grid").data("kendoGrid").dataSource.page($("#ttisoStruc_grid").data("kendoGrid").dataSource.page());
							    $("#ttisoStruc_grid").data("kendoGrid").dataSource.read();
	    			break;
	    			case "insertButt":
	    				$("#isoLookUp").data("kendoWindow").center().open();
	    			break;
	    			case "quickUpdate":
	    					$.post(crudService + "remove/autoDel_ttisoStruc",{
	    						
	    					},
					       	    function(data){
					       	    	
									 $("#ttisoStruc_grid").data("kendoGrid").setDataSource(ttisoStruc_ds);
									 $("#ttisoStruc_grid").data("kendoGrid").dataSource.page($("#ttisoStruc_grid").data("kendoGrid").dataSource.page());
									 $("#ttisoStruc_grid").data("kendoGrid").dataSource.read();

					       	    });
						
	    				$("#batchUpdate2").data("kendoWindow").center().open();
	    				
	    			break;
	    			case "editButt":
	    				$("#pieceStruct_grid").data("kendoGrid").editRow($("#pieceStruct_grid").data("kendoGrid").select());
	    				$(".wrap-button .buttonLeft  button").hide();
	    				$(".wrap-button .buttonRight  button").hide();
	    				$("#saveButt2,#cancelButt2").show();
	    				
	    			break
	    			case "exportButt":
	    				open_preloader();
						    	var link = document.createElement('a');
					        	link.href = crudService + "directCall/export_isoPieceStruc/?";
					        	link.href += ("fieldS=" + fieldSort2 + "&");
					        	link.href += ((query2 != "" ? ("fieldF[]=" + query2) : "fieldF=") + "&");
					        	link.href += ("dir=" + dirSort2);
					        	
					        	
					        	
						        //Dispatching click event.
						        if (document.createEvent) {
						            var e = document.createEvent('MouseEvents');
						            e.initEvent('click' ,true ,true);
						            link.dispatchEvent(e);
							    	close_preloader();
						            return true;
						        }
	    			break;
	    			case "saveButt2":
	    			case "cancelButt2":
	    				if (this.id == "saveButt2"){
		    				if (!confirm("Are you sure you want to save this data?"))
		    					return true;
		    				$("#pieceStruct_grid .k-grid-toolbar .k-grid-save-changes").trigger( "click" );
		    				$(".wrap-button .buttonLeft  button").show();
		    				$(".wrap-button .buttonRight  button").show();
		    				$("#saveButt2,#cancelButt2").hide();
		    				
	    				}else{
	    					$( "#pieceStruct_grid .k-grid-toolbar .k-grid-cancel-changes" ).trigger( "click" );
	    					$(".wrap-button .buttonLeft  button").show();
	    				$(".wrap-button .buttonRight  button").show();
	    				$("#saveButt2,#cancelButt2").hide();
	    					
	    				}
	    					
	    				
	    			break
	    			case "delButt":
	    				if (!confirm("Do you really want to delete this item?")){
	    					e.preventDefault();
	    					return true;
	    				}
	    				
						dataRow = $("#ttisoStruc_grid").data("kendoGrid").dataSource.getByUid(ttisoStruc_di.uid);
    					$("#ttisoStruc_grid").data("kendoGrid").dataSource.remove(dataRow);
						ttisoStruc_ds.sync();
						$("#ttisoStruc_grid").data("kendoGrid").setDataSource(ttisoStruc_ds);
						$("#ttisoStruc_grid").data("kendoGrid").dataSource.page($("#ttisoStruc_grid").data("kendoGrid").dataSource.page());
						$("#ttisoStruc_grid").data("kendoGrid").dataSource.read();
	    				return true;
	    			break;
	    			default:
						$(".wrap-form input, .wrap-form textarea, .wrap-form button").prop("disabled", false).removeClass("k-state-disabled");
		    			if (this.id == "addButt"){
		    				isFailed = false;
							$(".wrap-form input, .wrap-form textarea").val("");
							$(".wrap-form input").eq(0).select().focus();
							$('#rad1').prop("checked", true);
							$('input[name=option]').prop("disabled", true);
							cMode = "add";
		    			}else {
							$("#txt1").prop("disabled", true).addClass("k-state-disabled");
							$(".wrap-form textarea").select().focus();
							cMode = "edit";
						}
						$(".wrap-button button").prop("disabled", true).addClass("k-state-disabled");
						forDiv();
	    			break;
	    		}
	    	}
	    });
	    $(".wrap-button .buttonRight  button").bind({
	    	click: function(e){
	    		switch(this.id){
	    			case  "updButt" :
	    				conF = confirm("All Piecemark related in this drawing will be updated. Do you still want to continue?");
	    				if(!conF){
	    					dateHaul2.value("");
		    				dateChipping2.value("");
							datePacker2.value("");
							datePre2.value("");
							dateErection2.value("");
							dateAlignment2.value("");
							dateBolt2.value("");
	    					$("#batchUpdate2").data("kendoWindow").close();
	    				}else{
	    					var haulDate = kendo.toString(dateHaul2.value(),"yyyy-MM-dd");
	    					var chippingDate = kendo.toString(dateChipping2.value(),"yyyy-MM-dd");
	    					var packerDate = kendo.toString(datePacker2.value(),"yyyy-MM-dd");
	    					var preDate = kendo.toString(datePre2.value(),"yyyy-MM-dd");
	    					var erectionDate = kendo.toString(dateErection2.value(),"yyyy-MM-dd");
	    					var alignmentDate = kendo.toString(dateAlignment2.value(),"yyyy-MM-dd");
	    					var boltDate = kendo.toString(dateBolt2.value(),"yyyy-MM-dd");
	    					
	    					$.post(crudService + "manage/UpdPieceStruct",{haul:haulDate,chipping:chippingDate,packer:packerDate,assembly: preDate,erection: erectionDate,alignment: alignmentDate,bolt: boltDate},
					       	    
					       	    function(data){
					       	    	
									$("#pieceStruct_grid").data("kendoGrid").setDataSource(pieceStruct_ds);
									 $("#pieceStruct_grid").data("kendoGrid").dataSource.page($("#pieceStruct_grid").data("kendoGrid").dataSource.page());
									$("#pieceStruct_grid").data("kendoGrid").dataSource.read();
					       	    });
					       	    
	    					dateHaul2.value("");
		    				dateChipping2.value("");
							datePacker2.value("");
							datePre2.value("");
							dateErection2.value("");
							dateAlignment2.value("");
							dateBolt2.value("");
						 $("#batchUpdate2").data("kendoWindow").close();
	    				}
	    			
	    			break;
	    			case "batchUpdateButt":
	    				
	    				$("#batchUpdate").data("kendoWindow").center().open();
	    				
	    				
	    			break;
	    			default:
						$(".wrap-form input, .wrap-form textarea, .wrap-form button").prop("disabled", false).removeClass("k-state-disabled");
		    			if (this.id == "addButt"){
		    				isFailed = false;
							$(".wrap-form input, .wrap-form textarea").val("");
							$(".wrap-form input").eq(0).select().focus();
							$('#rad1').prop("checked", true);
							$('input[name=option]').prop("disabled", true);
							cMode = "add";
		    			}else {
							$("#txt1").prop("disabled", true).addClass("k-state-disabled");
							$(".wrap-form textarea").select().focus();
							cMode = "edit";
						}
						$(".wrap-button button").prop("disabled", true).addClass("k-state-disabled");
						forDiv();
	    			break;
	    		}
	    	}
	    });
	    
	     $("#batchUpdate .buttonRight  button").bind({
	    	click: function(e){
	    		switch(this.id){
	    			
	    			case "closeWindow":
	    				dateHaul.value("");
	    				dateChipping.value("");
						datePacker.value("");
						datePre.value("");
						dateErection.value("");
						dateAlignment.value("");
						dateBolt.value("");
	    				$("#batchUpdate").data("kendoWindow").close();
	    			break;
	    			case "saveButt":
	    				conF = confirm("All Piecemark related in this drawing will be updated. Do you still want to continue?");
	    				if(!conF){
	    					dateHaul.value("");
		    				dateChipping.value("");
							datePacker.value("");
							datePre.value("");
							dateErection.value("");
							dateAlignment.value("");
							dateBolt.value("");
	    					$("#batchUpdate").data("kendoWindow").close();
	    				}else{
	    					var haulDate = kendo.toString(dateHaul.value(),"yyyy-MM-dd");
	    					var chippingDate = kendo.toString(dateChipping.value(),"yyyy-MM-dd");
	    					var packerDate = kendo.toString(datePacker.value(),"yyyy-MM-dd");
	    					var preDate = kendo.toString(datePre.value(),"yyyy-MM-dd");
	    					var erectionDate = kendo.toString(dateErection.value(),"yyyy-MM-dd");
	    					var alignmentDate = kendo.toString(dateAlignment.value(),"yyyy-MM-dd");
	    					var boltDate = kendo.toString(dateBolt.value(),"yyyy-MM-dd");
	    					var procRecid = dataItem.PROGRESS_RECID
	    					var haul = "";
	    					$.post(crudService + "manage/UpdatePieceStruct",{haul:haulDate,chipping:chippingDate,packer:packerDate,assembly: preDate,erection: erectionDate,alignment: alignmentDate,bolt: boltDate,procRecid: procRecid},
					       	    
					       	    function(data){
					       	    	
									 $("#pieceStruct_grid").data("kendoGrid").setDataSource(pieceStruct_ds);
									 $("#pieceStruct_grid").data("kendoGrid").dataSource.page($("#pieceStruct_grid").data("kendoGrid").dataSource.page());
									 $("#pieceStruct_grid").data("kendoGrid").dataSource.read();
					       	    });
					       	    
	    					dateHaul.value("");
		    				dateChipping.value("");
							datePacker.value("");
							datePre.value("");
							dateErection.value("");
							dateAlignment.value("");
							dateBolt.value("");
							 $("#batchUpdate").data("kendoWindow").close();
	    					//open_preloader();
	    					// var link = document.createElement('a');
	    					// link.href = crudService + "manage/UpdatePieceStruct/?";
					        // link.href += ("fieldS=" + fieldSort + "&");
					        // link.href += ((query != "" ? ("fieldF[]=" + query) : "fieldF=") + "&");
					        // link.href += ("dir=" + dirSort);
					        // link.href += ("&haul=" + haulDate + "&chipping=" + chippingDate);
					        // link.href += ("&packer=" + packerDate + "&assembly=" + preDate);
					        // link.href += ("&erection=" + erectionDate + "&alignment=" + alignmentDate);
					        // link.href += ("&bolt=" + boltDate + "&procRecid=" + procRecid);
					        
					      	// dataSource.sync();
	    				}
	    			break
	    			default:
						$(".wrap-form input, .wrap-form textarea, .wrap-form button").prop("disabled", false).removeClass("k-state-disabled");
		    			if (this.id == "addButt"){
		    				isFailed = false;
							$(".wrap-form input, .wrap-form textarea").val("");
							$(".wrap-form input").eq(0).select().focus();
							$('#rad1').prop("checked", true);
							$('input[name=option]').prop("disabled", true);
							cMode = "add";
		    			}else {
							$("#txt1").prop("disabled", true).addClass("k-state-disabled");
							$(".wrap-form textarea").select().focus();
							cMode = "edit";
						}
						$(".wrap-button button").prop("disabled", true).addClass("k-state-disabled");
						forDiv();
	    			break;
	    		}
	    	}
	    });
	     // -- xx -- //
	     
	    $(".wrap-form button").bind({
	    	click: function(e){
	    		switch(this.id){
	    			case "saveButt":
	    				if (!confirm("Are you sure you want to save this data?")){
	    					e.preventDefault();
	    					return true;
	    				}
	    				
	    				isFailed = verifyThisInput(".formLeft_qms");
			    		if (isFailed)
			    			return true;
	    				
						if (cMode == "add"){
							dataSource.add({PROGRESS_RECID: 0,
											disc_code: $("#txt1").val(),
											disc_desc: $("#textarea").val(),
											flg_status: ($("#rad1").is(":checked") ? 1 : 0)});
							dataSource.sync();
							$("#rowSelection").data("kendoGrid").setDataSource(dataSource);
							$("#rowSelection").data("kendoGrid").dataSource.page($("#rowSelection").data("kendoGrid").dataSource.page());
							$("#rowSelection").data("kendoGrid").dataSource.read();
						}else
					        $.post(crudService + "manage/rdisc",{PROGRESS_RECID: dataItem.PROGRESS_RECID,disc_code: $("#txt1").val(), disc_desc: $("#textarea").val(), flg_status: ($("#rad1").is(":checked") ? 1 : 0)},
					       	    function(data){
									$("#rowSelection").data("kendoGrid").setDataSource(dataSource);
									$("#rowSelection").data("kendoGrid").dataSource.page($("#rowSelection").data("kendoGrid").dataSource.page());
									$("#rowSelection").data("kendoGrid").dataSource.read();
					       	    });
	    			break;
	    			default:
	    				$(".thisIsRequired").removeClass('thisIsRequired');
		    			isFailed = false;
			    		grid_change(currRow);
	    			break;
	    		}
	    		if (isFailed)
	    			return true;
				$(".wrap-form input, .wrap-form textarea, .wrap-form button").prop("disabled", true).addClass("k-state-disabled");
				$(".wrap-button button").prop("disabled", false).removeClass("k-state-disabled");
				$("#coverDiv").remove();
	    	}
	    });
	});
</script>