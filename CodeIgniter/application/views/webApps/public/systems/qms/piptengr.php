<script id="_temp_iso" type="text/x-kendo-template">
	<ul>
		<li><label class="title" for="plant_no">Plant No.:</label><input name="plant_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="plant_no" data-bind="value:plant_no" /> <!-- required validationMessage="Please Enter Plant No"  -->
			<label class="title short" style="width: 69px !important;" for="area_no">Area No.:</label><input name="area_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="area_no" data-bind="value:area_no" /></li> <!-- required validationMessage="Please Enter Area No"  -->
		<li><label class="title" for="drawing_no">Drawing No.:</label><input name="drawing_no" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="drawing_no" data-bind="value:drawing_no" /></li> <!-- required validationMessage="Please Enter Drawing No"  -->
		<li><label class="title" for="sheet_no">Sheet No.:</label><input name="sheet_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="sheet_no" data-bind="value:sheet_no" /> <!-- required validationMessage="Please Enter Sheet No" --> 
			<label class="title short" style="width: 69px !important;" for="rev_no">Rev. No.:</label><input name="rev_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="rev_no" data-bind="value:rev_no" /></li> <!-- required validationMessage="Please Enter Revision No" --> 
		<li><label class="title" for="subarea_no">Sub-Area No.:</label><input name="subarea_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="subarea_no" data-bind="value:subarea_no" /> <!-- required validationMessage="Please Enter Sub-Area No"  -->
			<label class="title short" style="width: 69px !important;" for="pid">P & ID:</label><input name="pid" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="pid" data-bind="value:pid" /></li> <!--required validationMessage="Please Enter Property ID" -->
		<li><label class="title" for="line_no">Line No.:</label><input name="line_no" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="line_no" data-bind="value:line_no" /></li> <!--required validationMessage="Please Enter Line No" -->
		<li><label class="title" for="document">Document:</label><input name="document" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="document" data-bind="value:document" /></li> <!--required validationMessage="Please Enter Document" -->
		<li><label class="title" for="line_size">Line Size:</label><input name="line_size" style="text-align: left;width: 100px;"
                        id="line_size" data-bind="value:line_size" data-role="numerictextbox" /> <!--required validationMessage="Please Enter Line Size" -->
			<label class="title short" for="lineclass">Line Class:</label><input name="lineclass" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="lineclass" data-bind="value:lineclass" /></li> <!--required validationMessage="Please Enter Line Class" -->
		<li><label class="title" for="painting">Painting:</label><input name="painting" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="painting" data-bind="value:painting" /></li> <!--required validationMessage="Please Enter Painting" -->
		<li><label class="title" for="insulation">Insulation:</label><input name="insulation" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="insulation" data-bind="value:insulation" /></li> <!--required validationMessage="Please Enter Insulation" -->
		<li><label class="title" for="insulation_thickness">Insulation Thick.:</label><input name="insulation_thickness" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="insulation_thickness" data-bind="value:insulation_thickness" /></li> <!--required validationMessage="Please Enter Insulation Thickness" -->
		<li><label class="title" for="transmittal">Transmittal:</label><input name="transmittal" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="transmittal" data-bind="value:transmittal" /></li> <!--required validationMessage="Please Enter Transmittal" -->
		<li><label class="title" for="matl">Material:</label><input name="matl" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="matl" data-bind="value:matl" /> <!--required validationMessage="Please Enter Material" -->
			<label class="title short" style="width: 69px !important;" for="lbsb">LB/SB:</label>
						<select name="lbsb" data-role="dropdownlist" style="width: 95px">
							<option value="LB">LB</option>
							<option value="SB">SB</option>
						</select>
			<!--<input name="lbsb" class="k-input k-textbox" style="text-align: left;width: 100px;" id="lbsb" data-bind="value:lbsb" /></li> required validationMessage="Please Enter LB/SB" -->
	</ul>
</script>
<script id="_temp_spool" type="text/x-kendo-template">
	<ul>
		<li><label class="title" for="plant_no">Plant No.:</label><input name="plant_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="plant_no" data-bind="value:plant_no" /> <!-- required validationMessage="Please Enter Plant No"  -->
			<label class="title short" style="width: 69px !important;" for="area_no">Area No.:</label><input name="area_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="area_no" data-bind="value:area_no" /></li> <!-- required validationMessage="Please Enter Area No"  -->
		<li><label class="title" for="drawing_no">Drawing No.:</label><input name="drawing_no" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="drawing_no" data-bind="value:drawing_no" /></li> <!-- required validationMessage="Please Enter Drawing No"  -->
		<li><label class="title" for="sheet_no">Sheet No.:</label><input name="sheet_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="sheet_no" data-bind="value:sheet_no" /> <!-- required validationMessage="Please Enter Sheet No" --> 
			<label class="title short" style="width: 69px !important;" for="rev_no">Rev. No.:</label><input name="rev_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="rev_no" data-bind="value:rev_no" /></li> <!-- required validationMessage="Please Enter Revision No" --> 
		<li><label class="title" for="spool_no">Spool No.:</label><input name="spool_no" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="spool_no" data-bind="value:spool_no" /></li> <!-- required validationMessage="Please Enter Sub-Area No"  -->
		<li><label class="title" for="spl_type">Spool Type:</label><select name="spl_type" data-role="dropdownlist" style="width: 277px">
							<option value="Spool">Spool</option>
							<option value="EM">EM</option>
						</select></li>
						<!--<input name="spool_type" class="k-input k-textbox" style="text-align: left;width: 277px;" id="spool_type" data-bind="value:spool_type" /></li> <!--required validationMessage="Please Enter Line No" -->
		<li><label class="title" for="testpack_no">Testpack No.:</label><input name="testpack_no" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="testpack_no" data-bind="value:testpack_no" /></li> <!--required validationMessage="Please Enter Document" -->
		<li><input type="radio" name="lbsb"
						id="lbsb_l" value="LB" data-bind="checked:lbsb" style="margin: 0 5px 0 112px;" /><label class="title chk" for="lbsb_l">Large Bore</label><!--required validationMessage="Please Enter Painting" -->
			<input type="radio" name="lbsb"
						id="lbsb_s" value="SB" data-bind="checked:lbsb" style="margin: 0 5px 0 0;" /><label class="title chk" for="lbsb_s">Small Bore</label></li> <!--required validationMessage="Please Enter Painting" -->
		<li><label class="title" for="tot_lm">Linear Meter:</label><input name="tot_lm" data-role="numerictextbox" style="text-align: left;width: 277px;"
                        id="tot_lm" data-bind="value:tot_lm" /></li> <!--required validationMessage="Please Enter Line Size" -->
		<li><label class="title" for="tot_diainch">Diainch:</label><input name="tot_diainch" data-role="numerictextbox" style="text-align: left;width: 277px;"
                        id="tot_diainch" data-bind="value:tot_diainch" /></li> <!--required validationMessage="Please Enter Painting" -->
		<li><input type="checkbox" name="spool_cont"
						id="spool_cont" data-bind="checked:spool_cont" style="margin: 0 5px 0 112px;" /><label class="title chk" for="spool_cont">Continuation Spool</label></li> <!--required validationMessage="Please Enter Painting" -->
	</ul>
</script>
<script id="_temp_joints" type="text/x-kendo-template">
	<ul>
		<li><label class="title" for="plant_no">Plant No.:</label><input name="plant_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="plant_no" data-bind="value:plant_no" /> <!-- required validationMessage="Please Enter Plant No"  -->
			<label class="title short" style="width: 69px !important;" for="area_no">Area No.:</label><input name="area_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="area_no" data-bind="value:area_no" /></li> <!-- required validationMessage="Please Enter Area No"  -->
		<li><label class="title" for="drawing_no">Drawing No.:</label><input name="drawing_no" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="drawing_no" data-bind="value:drawing_no" /></li> <!-- required validationMessage="Please Enter Drawing No"  -->
		<li><label class="title" for="sheet_no">Sheet No.:</label><input name="sheet_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="sheet_no" data-bind="value:sheet_no" /> <!-- required validationMessage="Please Enter Sheet No" --> 
			<label class="title short" style="width: 69px !important;" for="rev_no">Rev. No.:</label><input name="rev_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="rev_no" data-bind="value:rev_no" /></li> <!-- required validationMessage="Please Enter Revision No" --> 
		<li><label class="title" for="spool_no">Spool No.:</label><input name="spool_no" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="spool_no" data-bind="value:spool_no" /></li> <!-- required validationMessage="Please Enter Sub-Area No"  -->
		<li><label class="title" for="joint_no">Joint No:</label><input name="joint_no" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="joint_no" data-bind="value:joint_no" /></li> <!--required validationMessage="Please Enter Line No" -->
		<li><label class="title" for="joint_type">Joint Type:</label><input name="joint_type" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="joint_type" /></li> <!--required validationMessage="Please Enter Document" -->
		<li><label class="title" for="diainch">Diainch:</label><input name="diainch" data-role="numerictextbox" style="text-align: left;width: 277px;"
                        id="diainch" data-bind="value:diainch" /></li> <!--required validationMessage="Please Enter Line Size" -->
		<li><label class="title" for="size">Size:</label><input name="size" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="size" data-bind="value:size" /></li> <!--required validationMessage="Please Enter Painting" -->
		<li><label class="title" for="location">Location:</label><input name="location" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="location" data-bind="value:location" /></li> <!--required validationMessage="Please Enter Painting" -->
	</ul>
</script>
<script id="_temp_random" type="text/x-kendo-template">
	<ul>
		<li><label class="title" for="plant_no">Plant No.:</label><input name="plant_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="plant_no" data-bind="value:plant_no" /> <!-- required validationMessage="Please Enter Plant No"  -->
			<label class="title short" style="width: 69px !important;" for="area_no">Area No.:</label><input name="area_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="area_no" data-bind="value:area_no" /></li> <!-- required validationMessage="Please Enter Area No"  -->
		<li><label class="title" for="drawing_no">Drawing No.:</label><input name="drawing_no" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="drawing_no" data-bind="value:drawing_no" /></li> <!-- required validationMessage="Please Enter Drawing No"  -->
		<li><label class="title" for="sheet_no">Sheet No.:</label><input name="sheet_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="sheet_no" data-bind="value:sheet_no" /> <!-- required validationMessage="Please Enter Sheet No" --> 
			<label class="title short" style="width: 69px !important;" for="rev_no">Rev. No.:</label><input name="rev_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="rev_no" data-bind="value:rev_no" /></li> <!-- required validationMessage="Please Enter Revision No" --> 
		<li><label class="title" for="spool_no">Spool No.:</label><select name="spool_no" id="spool_no" style="width: 277px"></select></li>
			<!--<input name="spool_no" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="spool_no" data-bind="value:spool_no" /></li> <!-- required validationMessage="Please Enter Sub-Area No"  -->
		<li><label class="title" for="item_code">Item Code:</label><select name="item_code" id="item_code" style="width: 277px"></select></li>
			<!--<input name="item_code" style="text-align: left;width: 277px;" data-bind="value:item_code" data-value-field="item_code"
					    id="item_code" data-text-field="item_code" data-source="item_code_ds" data-role="dropdownlist" /></li>
			<!--<input name="item_code" data-text-field="text" data-value-field="value" data-role="dropdownlist"
						id="item_code" data-bind="value:item_code" /></li> <!--required validationMessage="Please Enter Line No" -->
		<li><label class="title" for="desc">Description:</label><textarea name="desc" class="k-input k-textbox k-state-disabled" disabled style="text-align: left;width: 277px;resize: none;"
                        id="desc"></textarea></li> <!--required validationMessage="Please Enter Document" -->
		<li><label class="title" for="random_qty">Random Qty:</label><input name="random_qty" data-role="numerictextbox" style="text-align: left;width: 277px;"
                        id="random_qty" data-bind="value:random_qty" /></li> <!--required validationMessage="Please Enter Painting" -->
		<li><label class="title" for="length">Length:</label><input name="length" data-role="numerictextbox" style="text-align: left;width: 277px;"
                        id="length" data-bind="value:length" /></li> <!--required validationMessage="Please Enter Painting" -->
	</ul>
</script>
<script id="_temp_material" type="text/x-kendo-template">
	<ul>
		<li><label class="title" for="plant_no">Plant No.:</label><input name="plant_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="plant_no" data-bind="value:plant_no" /> <!-- required validationMessage="Please Enter Plant No"  -->
			<label class="title short" style="width: 69px !important;" for="area_no">Area No.:</label><input name="area_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="area_no" data-bind="value:area_no" /></li> <!-- required validationMessage="Please Enter Area No"  -->
		<li><label class="title" for="drawing_no">Drawing No.:</label><input name="drawing_no" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="drawing_no" data-bind="value:drawing_no" /></li> <!-- required validationMessage="Please Enter Drawing No"  -->
		<li><label class="title" for="sheet_no">Sheet No.:</label><input name="sheet_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="sheet_no" data-bind="value:sheet_no" /> <!-- required validationMessage="Please Enter Sheet No" --> 
			<label class="title short" style="width: 69px !important;" for="rev_no">Rev. No.:</label><input name="rev_no" class="k-input k-textbox" style="text-align: left;width: 100px;"
                        id="rev_no" data-bind="value:rev_no" /></li> <!-- required validationMessage="Please Enter Revision No" --> 
		<li><label class="title" for="spool_no">Spool No.:</label><select name="spool_no" id="spool_no" style="width: 277px"></select></li>
			<!--<input name="spool_no" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="spool_no" data-bind="value:spool_no" /></li> <!-- required validationMessage="Please Enter Sub-Area No"  -->
		<li><label class="title" for="item_code">Item Code:</label><select name="item_code" id="item_code" style="width: 277px"></select></li>
			<!--<input name="item_code" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="item_code" data-bind="value:item_code" /></li> <!--required validationMessage="Please Enter Line No" -->
		<li><label class="title" for="desc">Description:</label><textarea name="desc" class="k-input k-textbox k-state-disabled" disabled style="text-align: left;width: 277px;"
                        id="desc"></textarea></li> <!--required validationMessage="Please Enter Document" -->
		<li><label class="title" for="qty">Quantity:</label><input name="qty" data-role="numerictextbox" style="text-align: left;width: 277px;"
                        id="qty" data-bind="value:qty" /></li> <!--required validationMessage="Please Enter Line Size" -->
		<li><label class="title" for="length">Length:</label><input name="length" data-role="numerictextbox" style="text-align: left;width: 277px;"
                        id="length" data-bind="value:length" /></li> <!--required validationMessage="Please Enter Painting" -->
		<li><label class="title" for="mat_type">Material Type:</label><input name="mat_type" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="mat_type" data-bind="value:mat_type" /></li> <!--required validationMessage="Please Enter Painting" -->
		<li><label class="title" for="size">Size:</label><input name="size" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="size" data-bind="value:size" /></li> <!--required validationMessage="Please Enter Painting" -->
		<li><label class="title" for="category">Category:</label><input name="category" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="category" data-bind="value:category" /></li> <!--required validationMessage="Please Enter Painting" -->
		<li><label class="title" for="painting_specs">Painting Specs.:</label><input name="painting_specs" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="painting_specs" data-bind="value:painting_specs" /></li> <!--required validationMessage="Please Enter Painting" -->
		<li><label class="title" for="commodity_code">Comm. Code:</label><input name="commodity_code" class="k-input k-textbox" style="text-align: left;width: 277px;"
                        id="commodity_code" data-bind="value:commodity_code" /></li> <!--required validationMessage="Please Enter Painting" -->
	</ul>
</script>

<div id="main-wrapper">
    <div class="wrap-grid demo-section">
        <div id="rowSelection"></div>
    </div>
    <div id="takeOff" style="margin-bottom: 5px;">
	    <div id="takeOff_ts">
	        <ul>
	            <li class="k-state-active">
	            	Spool / Joints / Random Pipes
	            </li>
	            <li>
	            	Material / Take-off 
	            </li>
	        </ul>
	        <div>
			    <div class="wrap-grid demo-section noapply" style="width: 300px;float:left;display: block;">
			        <div id="spool_rs"></div>
			        <div id="spool_dtl">
			        	<fieldset>
				        	<label class="title"><input type="checkbox" name="chk1" id="chk1" disabled /> Engineering </label>
				        	<label class="title"><input type="checkbox" name="chk2" id="chk2" disabled /> Warehouse </label>
				        	<label class="title"><input type="checkbox" name="chk3" id="chk3" disabled /> PCD </label>
				        </fieldset>
			        </div>
			    </div>
			    <div class="wrap-grid demo-section noapply" style="width: 300px;float:left;display: block;">
			        <div id="joints_rs"></div>
			        <div id="joints_dtl">
			        	<fieldset>
				        	<label class="title"><input type="radio" name="rad" id="rad1" disabled /> Shop Weld </label>
				        	<label class="title"><input type="radio" name="rad" id="rad2" disabled /> Field Weld </label>
				        </fieldset>
			        </div>
			    </div>
			    <div class="wrap-grid demo-section noapply" style="width: 300px;float:right;display: block;">
			        <div id="random_rs"></div>
			        <div id="random_dtl">
			        	<fieldset>
				        	<textarea name="textarea" id="textarea" style="width: 95%;height: 32px;resize: none;"></textarea>
				        </fieldset>
			        </div>
			    </div>
	        </div>	
	        <div>
			    <div class="wrap-grid demo-section noapply" style="width: 955px;">
			        <div id="material_rs"></div>
			        <div id="material_dtl">
			        	<fieldset>
				        	<input type="text" class="k-textbox" disabled name="txt1" id="txt1" />
				        </fieldset>
			        </div>
			    </div>
	        </div>	        	
	    </div>
	</div>
	<div class="wrap-button demo-section">
		<div class="buttonRight">
        	<button class="k-button mainEve" id="closeButt">Close</button>
       	</div>				
	</div>
</div>
<script type="text/javascript">
	$(document).ready(function(){
		$("body").css({"background": "url('/assets/images/webapps/<?php echo $system; ?>_bg_blur_1.jpg') no-repeat fixed center top #222", "background-size": "100% 100%"});
		var crudService = crudServiceBaseUrl + "qms/index/",
		    filterFArr = [], filterOArr = [], filterVArr = [], sentValue = "",
		    filterFArr_spool = [], filterOArr_spool = [], filterVArr_spool = [], sentValue_spool = "",
		    filterFArr_joints = [], filterOArr_joints = [], filterVArr_joints = [], sentValue_joints = "",
		    filterFArr_random = [], filterOArr_random = [], filterVArr_random = [], sentValue_random = "",
		    filterFArr_material = [], filterOArr_material = [], filterVArr_material = [], sentValue_material = "", currRow = "",
		    dataItem = "", spool_di = "", joints_di = "", random_di = "", material_di = "";
        
        var dataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: crudService + "directCall/isoTO",
                    contentType: "application/json",
                    type: "GET"
                },
                create: {
                    url: crudService + "manage/isoTO",
                    type: "POST"
                },
                update: {
                    url: crudService + "manage/isoTO",
                    type: "POST"
                },
                destroy: {
                    url: crudService + "remove/isoTO",
                    type: "POST"
                },
			    parameterMap: function(data, type) {
			      if (type == "read") {
			      	if ($(data.filter).length > 0){
				      	$.each(data.filter.filters,function(index,value){
				      		var valForm = ((typeof this.value) == "object") ? kendo.toString(this.value,"yyyy-MM-dd") : this.value;
				      		filterFArr[index] = this.field + ";" + valForm + ";" + this.operator;
				      		filterOArr[index] = this.operator;
				      		filterVArr[index] = valForm;
				      	});
				    }
			        return {
			            page: data.page,
			            pageSize: data.pageSize,
			            top: data.take,
			            skip: data.skip,
					    fieldF: filterFArr,
					    fieldS: ($(data.sort).length ? data.sort[0].field : "area_no"),
					    operator: (($(data.filter).length > 0) ? filterOArr : "contains"),
					    value: (($(data.filter).length > 0) ? filterVArr : sentValue),
					    dir: ($(data.sort).length ? data.sort[0].dir : "desc")
			        }
			      }else {
			      	  data['loguser'] = $("#hidden_user").val();
			      	  data['discipline'] = "";
			      	  return data;
			      }
			    }
            },
			  requestEnd: function(e) {
			    var response = e.response;
			    var type = e.type;
			    // console.log(type);
			    // console.log(response);
			  },
            pageSize: 5,
            serverPaging: true,
			serverFiltering: true,
			serverSorting: true,
            schema: {
                data: function(data) {
                    return data.rows || [];
               },
               errors: function(data){
               	if (filterFArr.length > 0 && $(data.rows).length == 0){
               		alert("No records found!");
					sentValue = "";
					filterFArr = [];
					$("form.k-filter-menu button[type='reset']").trigger("click");
               	}
               },
               model: {
               		id: "PROGRESS_RECID",
                    fields: {
                   	    PROGRESS_RECID: {type: "number", editable: false},
                        area_no: { type: "string"},
                        drawing_no: { type: "string" },
                   	    sheet_no: { type: "string"},
                        rev_no: { type: "string"},
                        stat: { type: "string"},
                        line_size: { type: "number"},
                        line_no: { type: "string"},
                        lineclass: { type: "string"},
                        matl: { type: "string"},
                        fluid_code: { type: "string"},
                        insulation: { type: "string"},
                        insulation_thickness: { type: "string"},
                        lbsb: { type: "string"},
                        painting: { type: "string"},
                        pid: { type: "string"},
                        transmittal: { type: "string"},
                        remarks: { type: "string"},
                        document: { type: "string"},
                        subarea_no: { type: "string"},
                        plant_no: { type: "string"}
                    }
               },
               total: function(response) {
				   	return (($(response.rows[0]).length > 0) ? response.rows[0].total : 0); //$(response.rows).length;				   	
			   }
            },
            change: function(e) {
            	if ($(e.items).length == 0)
            		return true;
            }
        });
                                
	    var addExtraStylingToGrid = function () {
			$("#rowSelection").data("kendoGrid").select("tr:eq(1)");
	        $(".k-grid-content > table > tbody > tr").hover(
	            function() {
	                $(this).toggleClass("k-state-hover");
	            }			        
	        );
        	filterFArr = [];
	    };
        
        var grid = $("#rowSelection").kendoGrid({
            dataSource: dataSource,
            selectable: "row",
            pageable: {
                buttonCount: 5,
                refresh: true,
                pageSizes: true,
    			input: true
            },
            groupable: false,
            sortable: true,
            scrollable: true,
            navigatable: true,
            editable: false,
            resizable: true,
            editable: {
            	mode: "popup",
		        template: $("#_temp_iso").html(),
		        update  : true
		        // ,
		        // add     : true,
		        // destroy : true,
		        // confirmation: "Are you sure you want to remove ?",
		    },
		    edit : function (e) {
		        if (!e.model.id) {
		            $(e.container).parent().find('.k-window-title').html("Add ISO");
		            $(e.container).parent().find('.k-grid-update').html("Save");
		        	$(e.container).find("input:first-child").select().focus();
		        }else{
		        	if (cMode == "edit"){
			            $(e.container).parent().find('.k-window-title').html("Edit ISO");
			    		$.each($(e.container).find("input"), function(index, value){
			    			if (index <= 4)
			    				$(this).attr("disabled",true).addClass('k-state-disabled');
			    		});
			        	$(e.container).find("input").eq(5).select().focus();
			        }else
			    		$.each($(e.container).find("input"), function(index, value){
			    			$(this).attr("disabled",true).addClass('k-state-disabled');
			    		});
		        }
		    },
			save: function(e) {
			    if (!confirm("Are you sure you want to save all changes?")) {
			        e.preventDefault();
			    }
			    
				$("#rowSelection").data("kendoGrid").setDataSource(dataSource);
				$("#rowSelection").data("kendoGrid").dataSource.page($("#rowSelection").data("kendoGrid").dataSource.page());
				$("#rowSelection").data("kendoGrid").dataSource.read();
			},
			remove: function(e) {
			    if (!confirm("Are you sure you want to delete this record?\n Drawing: " + e.model.drawing_no)) {
			        e.preventDefault();
			    }
				$("#rowSelection").data("kendoGrid").setDataSource(dataSource);
				$("#rowSelection").data("kendoGrid").dataSource.page($("#rowSelection").data("kendoGrid").dataSource.page());
				$("#rowSelection").data("kendoGrid").dataSource.read();
			},
            toolbar: [
	            {
				    text: "Add",
				    className: "k-grid-add",
				    imageClass: "k-icon k-add"
				},
				{
				    text: "Edit",
				    className: "k-grid-edit",
				    imageClass: "k-icon k-edit"
				},
				{
				    text: "Delete",
				    className: "k-grid-delete",
				    imageClass: "k-icon k-delete"
				},
				{
				    text: "View",
				    className: "k-grid-view",
				    imageClass: "k-icon k-edit"
				},
				{
				    text: "View Attachment",
				    className: "k-grid-viewAtt",
				    imageClass: "k-icon k-edit"
				},"save","cancel"
			],
            filterable: {
                extra: false
            },
            columns: [
               {field: "area_no",title: "Area",width: 52},
               {field: "drawing_no",title: "Drawing",width: 125},
               {field: "sheet_no",title: "Sheet",width: 63},
               {field: "rev_no",title: "Revision",width: 77},
               {field: "stat",title: "Status",width: 66},
               {field: "line_size",title: "Line Size",width: 80},
               {field: "line_no",title: "Line No",width: 158},
               {field: "lineclass",title: "Line Class",width: 89},
               {field: "matl",title: "Material",width: 77},
               {field: "fluid_code",title: "Fluid Code",width: 93},
               {field: "insulation",title: "Insulation",width: 89},
               {field: "insulation_thickness",title: "Insulation Thickness",width: 154},
               {field: "lbsb",title: "Bore Type",width: 89},
               {field: "painting",title: "Painting",width: 79},
               {field: "pid",title: "PID",width: 50},
               {field: "transmittal",title: "Transmittal",width: 99},
               {field: "remarks",title: "Remarks",width: 78},
               {field: "document",title: "Document",width: 90},
               {field: "subarea_no",title: "Sub-Area No",width: 104},
               {field: "plant_no",title: "Plant No",width: 76}
           ],
           change: function(e){
           		currRow = this;
			    var selectedRows = this.select();
			    var selectedDataItems = [];
			    for (var i = 0; i < selectedRows.length; i++) {
			        dataItem = this.dataItem(selectedRows[i]);
        			if (!$("#material_rs").is(":visible")) {
		    			filterFArr_spool = [];
		    			spool_ds.read();
		    			filterFArr_random = [];
		    			random_ds.read();
		    		} else {
	        			filterFArr_material = [];
	        			material_ds.read();
	        		}
			    }
           },
           dataBound: addExtraStylingToGrid
        });
        
        var toggleButt = function(vis){
	        $.each($("#rowSelection .k-grid-toolbar").find("a"),function(index, value){
	        	eval("$(this)." + ((index <= 3) ? vis : ((vis == "show") ? "hide" : "show")) + "();")
	        });
	    }
	    toggleButt("show");
        
        var spool_ds = new kendo.data.DataSource({
            transport: {
                read: {
                    url: crudService + "directCall/spool",
                    contentType: "application/json",
                    type: "GET"
                },
                create: {
                    url: crudService + "manage/spool",
                    type: "POST"
                },
                update: {
                    url: crudService + "manage/spool",
                    type: "POST"
                },
                destroy: {
                    url: crudService + "remove/spool",
                    type: "POST"
                },
			    parameterMap: function(data, type) {
			      if (type == "read") {
			      	if ($(data.filter).length > 0){
				      	$.each(data.filter.filters,function(index,value){
				      		var valForm = ((typeof this.value) == "object") ? kendo.toString(this.value,"yyyy-MM-dd") : this.value;
				      		filterFArr_spool[index] = this.field + ";" + valForm + ";" + this.operator;
				      		filterOArr_spool[index] = this.operator;
				      		filterVArr_spool[index] = valForm;
				      	});
				    }
			        return {
			            page: data.page,
			            pageSize: data.pageSize,
			            top: data.take,
			            skip: data.skip,
					    fieldF: filterFArr_spool,
					    fieldS: ($(data.sort).length ? data.sort[0].field : "area_no"),
					    operator: (($(data.filter).length > 0) ? filterOArr_spool : "contains"),
					    value: (($(data.filter).length > 0) ? filterVArr_spool : sentValue_spool),
					    dir: ($(data.sort).length ? data.sort[0].dir : "desc"),
					    plant_no: dataItem.plant_no,
					    area_no: dataItem.area_no,
					    drawing_no: dataItem.drawing_no,
					    sheet_no: dataItem.sheet_no,
					    rev_no: dataItem.rev_no
			        }
			      }else{
			      	data['loguser'] = $("#hidden_user").val();
			      	data['plant_no'] = dataItem.plant_no;
			      	data['area_no'] = dataItem.area_no;
			      	data['drawing_no'] = dataItem.drawing_no;
			      	data['sheet_no'] = dataItem.sheet_no;
			      	data['rev_no'] = dataItem.rev_no;
			      	data['subarea_no'] = dataItem.subarea_no;
			      	data['mat_issued_date'] = kendo.toString((new Date()),"yyyy-MM-dd");
			      	data['received_date'] = kendo.toString((new Date()),"yyyy-MM-dd");
			      	data['spool_issued_date'] = kendo.toString((new Date()),"yyyy-MM-dd");
			      	data['workable_dt'] = kendo.toString((new Date()),"yyyy-MM-dd");
			      	return data;
			      }
			    }
            },
            pageSize: 5,
            serverPaging: true,
			serverFiltering: true,
			serverSorting: true,
            schema: {
                data: function(data) {
                    return data.rows || [];
               },
               errors: function(data){
               	// if (filterFArr_spool.length > 0 && $(data.rows).length == 0){
               		// alert("No records found!");
					// sentValue_spool = "";
					// filterFArr_spool = [];
					// $("form.k-filter-menu button[type='reset']").trigger("click");
               		// //grid.data("kendoGrid").dataSource.read();
               	// }
				//alert("Error");
               },
               model: {
               		id: "PROGRESS_RECID",
                    fields: {
                   	    PROGRESS_RECID: {type: "number", editable: false},
                        spool_no: { type: "string"},
                        spl_type: { type: "string" },
                   	    spl_stat: { type: "string"},
                        spool_cont: { type: "boolean"},
                        spool_id: { type: "string"},
                        erect_workable_pct: { type: "number"},
                        mat_issued_date: { type: "date"},
                        received_date: { type: "date"},
                        spool_issued_date: { type: "date"},
                        spool_qty: { type: "number"},
                        sw_diainch: { type: "number"},
                        workable_dt: { type: "date"},
                        workable_pct: { type: "number"},
                        lengg: { type: "boolean" },
                        lwhse: { type: "boolean" },
                        lpcd: { type: "boolean" }
                    }
               },
               total: function(response) {
				  	return (($(response.rows[0]).length > 0) ? response.rows[0].total : 0); //$(response.rows).length;
			   }
            },
            change: function(e) {
        		joints_ds.read();
            	if ($(e.items).length == 0)
            		return true;
            		
           		currRow = this;
				var spool_di = e.items[0];
		        $("#chk1").prop("checked", spool_di.lengg);
		        $("#chk2").prop("checked", spool_di.lwhse);
		        $("#chk3").prop("checked", spool_di.lpcd);
		        $("#rad1").prop("checked", (spool_di.spool_no == "EM"));
		        $("#rad2").prop("checked", (spool_di.spool_no != "EM"));
        		joints_ds.read();
            }
        });
                                
	    var addExtraStylingToGrid_spool = function () {
			$("#spool_rs").data("kendoGrid").select("tr:eq(" + (dataSource._data.length + 2) + ")");
	        $(".k-grid-content > table > tbody > tr").hover(
	            function() {
	                $(this).toggleClass("k-state-hover");
	            }			        
	        );
        	filterFArr_spool = [];
	    };
    
        var spool_rs = $("#spool_rs").kendoGrid({
            dataSource: spool_ds,
            selectable: "row",
            autoBind: false,
            pageable: false,
            height: "246px",
            pageable: {
                buttonCount: 2,
			    messages: {
			        itemsPerPage: "records/page"
			    }
            },
            groupable: false,
            sortable: true,
            scrollable: true,
            navigatable: true,
            editable: false,
            resizable: true,
            editable: {
            	mode: "popup",
		        template: $("#_temp_spool").html(),
		        update  : true
		    },
		    edit : function (e) {
		        if (!e.model.id) {
		            $(e.container).parent().find('.k-window-title').html("Add Spool");
		            $(e.container).parent().find('.k-grid-update').html("Save");
		    		$.each($(e.container).find("input"), function(index, value){
		    			if (index <= 4)
		    				$(this).val(eval("dataItem." + this.id)).attr("disabled",true).addClass('k-state-disabled');
		    		});
		        }else{
		        	if (cMode == "edit"){
			            $(e.container).parent().find('.k-window-title').html("Edit Spool");
			    		$.each($(e.container).find("input"), function(index, value){
			    			if (index <= 4)
			    				$(this).attr("disabled",true).addClass('k-state-disabled');
			    		});
			        	$(e.container).find("input").eq(5).select().focus();
			        }else
			    		$.each($(e.container).find("input"), function(index, value){
			    			$(this).attr("disabled",true).addClass('k-state-disabled');
			    		});
		        }
		    },
			save: function(e) {
			    if (!confirm("Are you sure you want to save all changes?")) {
			        e.preventDefault();
			    }
			    
				$("#spool_rs").data("kendoGrid").setDataSource(spool_ds);
				$("#spool_rs").data("kendoGrid").dataSource.page($("#spool_rs").data("kendoGrid").dataSource.page());
				$("#spool_rs").data("kendoGrid").dataSource.read();
			},
			remove: function(e) {
			    if (!confirm("Are you sure you want to delete this record?\n Spool: " + e.model.spool_no)) {
			        e.preventDefault();
			    }
				$("#spool_rs").data("kendoGrid").setDataSource(spool_ds);
				$("#spool_rs").data("kendoGrid").dataSource.page($("#spool_rs").data("kendoGrid").dataSource.page());
				$("#spool_rs").data("kendoGrid").dataSource.read();
			},
            toolbar: [
	            {
				    text: "Add",
				    className: "k-grid-add",
				    imageClass: "k-icon k-add"
				},
				{
				    text: "Edit",
				    className: "k-grid-edit",
				    imageClass: "k-icon k-edit"
				},
				{
				    text: "Delete",
				    className: "k-grid-delete",
				    imageClass: "k-icon k-delete"
				},
				{
				    text: "View",
				    className: "k-grid-view",
				    imageClass: "k-icon k-edit"
				},"save","cancel"
			],
            filterable: {
                extra: false
            },
            columns: [
               {field: "area_no",title: "Area",width: 52, hidden: true},
               {field: "drawing_no",title: "Drawing",width: 125, hidden: true},
               {field: "sheet_no",title: "Sheet",width: 63, hidden: true},
               {field: "rev_no",title: "Revision",width: 77, hidden: true},
               {field: "plant_no",title: "Plant No",width: 77, hidden: true},
               {field: "spool_no",title: "Spool No.",width: 80},
               {field: "spl_type",title: "Spool Type",width: 94},
               {field: "spl_stat",title: "Spool Status",width: 105},
               {field: "spool_cont",title: "Spool Cont.",width: 97},
               {field: "spool_id",title: "Spool ID",width: 80},
               {field: "erect_workable_pct",title: "Erect Work.",width: 96},
               {field: "mat_issued_date",title: "Issued Date",width: 101,format: "{0:MM/dd/yyyy}"},
               {field: "received_date",title: "Received Date",width: 115,format: "{0:MM/dd/yyyy}"},
               {field: "spool_issued_date",title: "Iss. Date",width: 90,format: "{0:MM/dd/yyyy}"},
               {field: "spool_qty",title: "Spool Qty.",width: 89},
               {field: "sw_diainch",title: "Shop Dia-Inch",width: 111},
               {field: "workable_dt",title: "Workable Date",width: 117,format: "{0:MM/dd/yyyy}"},
               {field: "workable_pct",title: "Workable",width: 82}
           ],
           change: function(e){
           		currRow = this;
			    var selectedRows = this.select();
			    var selectedDataItems = [];
			    for (var i = 0; i < selectedRows.length; i++) {
			        spool_di = this.dataItem(selectedRows[i]);
			        $("#chk1").prop("checked", spool_di.lengg);
			        $("#chk2").prop("checked", spool_di.lwhse);
			        $("#chk3").prop("checked", spool_di.lpcd);
			        $("#rad1").prop("checked", (spool_di.spool_no == "EM"));
			        $("#rad2").prop("checked", (spool_di.spool_no != "EM")); 
        			joints_ds.read();
			    }
           },
           dataBound: addExtraStylingToGrid_spool
        });
        
        var toggleButt_spool = function(vis){
	        $.each($("#spool_rs .k-grid-toolbar").find("a"),function(index, value){
	        	eval("$(this)." + ((index <= 3) ? vis : ((vis == "show") ? "hide" : "show")) + "();")
	        });
	    }
	    toggleButt_spool("show");
        
        var joints_ds = new kendo.data.DataSource({
            transport: {
                read: {
                    url: crudService + "directCall/joints",
                    contentType: "application/json",
                    type: "GET"
                },
                create: {
                    url: crudService + "manage/joints",
                    type: "POST"
                },
                update: {
                    url: crudService + "manage/joints",
                    type: "POST"
                },
                destroy: {
                    url: crudService + "remove/joints",
                    type: "POST"
                },
			    parameterMap: function(data, type) {
			      if (type == "read") {
			      	if ($(data.filter).length > 0){
				      	$.each(data.filter.filters,function(index,value){
				      		var valForm = ((typeof this.value) == "object") ? kendo.toString(this.value,"yyyy-MM-dd") : this.value;
				      		filterFArr_joints[index] = this.field + ";" + valForm + ";" + this.operator;
				      		filterOArr_joints[index] = this.operator;
				      		filterVArr_joints[index] = valForm;
				      	});
				    }
			        return {
			            page: data.page,
			            pageSize: data.pageSize,
			            top: data.take,
			            skip: data.skip,
					    fieldF: filterFArr_joints,
					    fieldS: ($(data.sort).length ? data.sort[0].field : "joint_no"),
					    operator: (($(data.filter).length > 0) ? filterOArr_joints : "contains"),
					    value: (($(data.filter).length > 0) ? filterVArr_joints : sentValue_joints),
					    dir: ($(data.sort).length ? data.sort[0].dir : "desc"),
					    plant_no: dataItem.plant_no,
					    area_no: dataItem.area_no,
					    drawing_no: dataItem.drawing_no,
					    sheet_no: dataItem.sheet_no,
					    rev_no: dataItem.rev_no,
					    spool_no: spool_di.spool_no
			        }
			      }else{
			      	  data['loguser'] = $("#hidden_user").val();
			      	  data['plant_no'] = dataItem.plant_no;
			      	  data['area_no'] = dataItem.area_no;
			      	  data['drawing_no'] = dataItem.drawing_no;
			      	  data['sheet_no'] = dataItem.sheet_no;
			      	  data['rev_no'] = dataItem.rev_no;
			      	  data['subarea_no'] = dataItem.subarea_no;
			      	  data['spool_no'] = spool_di.spool_no;
			      	  data['weld_loc'] = ($("#rad1").is(":checked") ? 1 : 2)
			      	  return data;
			      }
			    }
            },
            pageSize: 5,
            serverPaging: true,
			serverFiltering: true,
			serverSorting: true,
            schema: {
                data: function(data) {
                    return data.rows || [];
               },
               errors: function(data){
               	// if (filterFArr_joints.length > 0 && $(data.rows).length == 0){
               		// alert("No records found!");
					// sentValue_joints = "";
					// filterFArr_joints = [];
					// $("form.k-filter-menu button[type='reset']").trigger("click");
               		// //grid.data("kendoGrid").dataSource.read();
               	// }

				//alert("Error");
               },
               model: {
               		id: "PROGRESS_RECID",
                    fields: {
                   	    PROGRESS_RECID: {type: "number", editable: false},
                        joint_no: { type: "string"},
                        joint_type: { type: "string" },
                   	    size: { type: "string"},
                        diainch: { type: "decimal"}
                    }
               },
               total: function(response) {
				   return (($(response.rows[0]).length > 0) ? response.rows[0].total : 0); //$(response.rows).length;
			   }
            },
            change: function(e) {
            	if ($(e.items).length == 0)
            		return true;
            		
           		currRow = this;
				var data = e.items[0];
            }
        });
                                
	    var addExtraStylingToGrid_joints = function () {
			$("#joints_rs").data("kendoGrid").select("tr:eq(" + ((dataSource._data.length + spool_ds._data.length) + 3) + ")");
	        $(".k-grid-content > table > tbody > tr").hover(
	            function() {
	                $(this).toggleClass("k-state-hover");
	            }			        
	        );
        	filterFArr_joints = [];
	    };
        
        var joints_rs = $("#joints_rs").kendoGrid({
            dataSource: joints_ds,
            selectable: "row",
            autoBind: false,
            pageable: false,
            height: "246px",
            pageable: {
                buttonCount: 2,
			    messages: {
			        itemsPerPage: "records/page"
			    }
            },
            groupable: false,
            sortable: true,
            scrollable: true,
            navigatable: true,
            resizable: true,
            editable: {
            	mode: "popup",
		        template: $("#_temp_joints").html(),
		        update  : true
		    },
		    edit : function (e) {
		        if (!e.model.id) {
		            $(e.container).parent().find('.k-window-title').html("Add Joints");
		            $(e.container).parent().find('.k-grid-update').html("Save");
		    		$.each($(e.container).find("input"), function(index, value){
		    			if (index <= 5)
		    				$(this).val(eval("dataItem." + this.id)).attr("disabled",true).addClass('k-state-disabled');
		    		});
		        }else{
		        	if (cMode == "edit"){
			            $(e.container).parent().find('.k-window-title').html("Edit Joints");
			    		$.each($(e.container).find("input"), function(index, value){
			    			if (index <= 5)
			    				$(this).attr("disabled",true).addClass('k-state-disabled');
			    		});
			        	$(e.container).find("input").eq(6).select().focus();
			        }else
			    		$.each($(e.container).find("input"), function(index, value){
			    			$(this).attr("disabled",true).addClass('k-state-disabled');
			    		});
		        }
		    },
			save: function(e) {
			    if (!confirm("Are you sure you want to save all changes?")) {
			        e.preventDefault();
			    }
			    
				$("#joints_rs").data("kendoGrid").setDataSource(joints_ds);
				$("#joints_rs").data("kendoGrid").dataSource.page($("#joints_rs").data("kendoGrid").dataSource.page());
				$("#joints_rs").data("kendoGrid").dataSource.read();
			},
			remove: function(e) {
			    if (!confirm("Are you sure you want to delete this record?\n Joint: " + e.model.joint_no)) {
			        e.preventDefault();
			    }
				$("#joints_rs").data("kendoGrid").setDataSource(joints_ds);
				$("#joints_rs").data("kendoGrid").dataSource.page($("#joints_rs").data("kendoGrid").dataSource.page());
				$("#joints_rs").data("kendoGrid").dataSource.read();
			},
            toolbar: [
	            {
				    text: "Add",
				    className: "k-grid-add",
				    imageClass: "k-icon k-add"
				},
				{
				    text: "Edit",
				    className: "k-grid-edit",
				    imageClass: "k-icon k-edit"
				},
				{
				    text: "Delete",
				    className: "k-grid-delete",
				    imageClass: "k-icon k-delete"
				},
				{
				    text: "View",
				    className: "k-grid-view",
				    imageClass: "k-icon k-edit"
				},"save","cancel"
			],
            filterable: {
                extra: false
            },
            columns: [
               {field: "joint_no",title: "Joint No",width: 80},
               {field: "joint_type",title: "Joint Type",width: 89},
               {field: "size",title: "Size",width: 54},
               {field: "diainch",title: "Diainch",width: 74}
           ],
           change: function(e){
           		currRow = this;
			    var selectedRows = this.select();
			    var selectedDataItems = [];
			    for (var i = 0; i < selectedRows.length; i++) {
			        joints_di = this.dataItem(selectedRows[i]);
			    }
           },
           dataBound: addExtraStylingToGrid_joints
        });
        
        var toggleButt_joints = function(vis){
	        $.each($("#joints_rs .k-grid-toolbar").find("a"),function(index, value){
	        	eval("$(this)." + ((index <= 3) ? vis : ((vis == "show") ? "hide" : "show")) + "();")
	        });
	    }
	    toggleButt_joints("show");
        
        var random_ds = new kendo.data.DataSource({
            transport: {
                read: {
                    url: crudService + "directCall/random",
                    contentType: "application/json",
                    type: "GET"
                },
                create: {
                    url: crudService + "manage/random",
                    type: "POST"
                },
                update: {
                    url: crudService + "manage/random",
                    type: "POST"
                },
                destroy: {
                    url: crudService + "remove/random",
                    type: "POST"
                },
			    parameterMap: function(data, type) {
			      if (type == "read") {
			      	if ($(data.filter).length > 0){
				      	$.each(data.filter.filters,function(index,value){
				      		var valForm = ((typeof this.value) == "object") ? kendo.toString(this.value,"yyyy-MM-dd") : this.value;
				      		filterFArr_random[index] = this.field + ";" + valForm + ";" + this.operator;
				      		filterOArr_random[index] = this.operator;
				      		filterVArr_random[index] = valForm;
				      	});
				    }
			        return {
			            page: data.page,
			            pageSize: data.pageSize,
			            top: data.take,
			            skip: data.skip,
					    fieldF: filterFArr_random,
					    fieldS: ($(data.sort).length ? data.sort[0].field : "area_no"),
					    operator: (($(data.filter).length > 0) ? filterOArr_random : "contains"),
					    value: (($(data.filter).length > 0) ? filterVArr_random : sentValue_spool),
					    dir: ($(data.sort).length ? data.sort[0].dir : "desc"),
					    plant_no: dataItem.plant_no,
					    area_no: dataItem.area_no,
					    drawing_no: dataItem.drawing_no,
					    sheet_no: dataItem.sheet_no,
					    rev_no: dataItem.rev_no
			        }
			        /*return kendo.stringify(data);*/
			      }else{
			      	  data['loguser'] = $("#hidden_user").val();
			      	  data['plant_no'] = dataItem.plant_no;
			      	  data['area_no'] = dataItem.area_no;
			      	  data['drawing_no'] = dataItem.drawing_no;
			      	  data['sheet_no'] = dataItem.sheet_no;
			      	  data['rev_no'] = dataItem.rev_no;
			      	  data['subarea_no'] = dataItem.subarea_no;
			      	  return data;
			      }
			    }
            },
            pageSize: 5,
            serverPaging: true,
			serverFiltering: true,
			serverSorting: true,
            schema: {
                data: function(data) {
                    return data.rows || [];
               },
               errors: function(data){
               	// if (filterFArr_random.length > 0 && $(data.rows).length == 0){
               		// alert("No records found!");
					// sentValue_random = "";
					// filterFArr_random = [];
					// $("form.k-filter-menu button[type='reset']").trigger("click");
               		// //grid.data("kendoGrid").dataSource.read();
               	// }

				//alert("Error");
               },
               model: {
               		id: "PROGRESS_RECID",
                    fields: {
                   	    PROGRESS_RECID: {type: "number", editable: false},
                        item_code: { type: "string"},
                        length: { type: "number" },
                   	    random_qty: { type: "number"}
                    }
               },
               total: function(response) {
				   return (($(response.rows[0]).length > 0) ? response.rows[0].total : 0); //$(response.rows).length;
			   }
            },
            change: function(e) {
            	if ($(e.items).length == 0)
            		return true;
            		
           		currRow = this;
				var data = e.items[0];
            }
        });        
                                
	    var addExtraStylingToGrid_random = function () {
			$("#random_rs").data("kendoGrid").select("tr:eq(" + ((dataSource._data.length + spool_ds._data.length + joints_ds._data.length) + 4) + ")");
	        $(".k-grid-content > table > tbody > tr").hover(
	            function() {
	                $(this).toggleClass("k-state-hover");
	            }			        
	        );
        	filterFArr_random = [];
	    };
        var random_rs = $("#random_rs").kendoGrid({
            dataSource: random_ds,
            selectable: "row",
            autoBind: false,
            pageable: false,
            height: "226px",
            pageable: {
                buttonCount: 2,
			    messages: {
			        itemsPerPage: "records/page"
			    }
            },
            groupable: false,
            sortable: true,
            scrollable: true,
            navigatable: true,
            resizable: true,
            editable: {
            	mode: "popup",
		        template: $("#_temp_random").html(),
		        update  : true
		    },
		    edit : function (e) {
		        var spool_no = $("#spool_no").kendoDropDownList({
		            filter: "contains",
		            placeholder: "Select Spool...",
		            dataTextField: "spool_no",
		            dataValueField: "spool_no",
		            highlightFirst: true,
		            dataSource: {
		                transport: {
		                    read: crudService + "directCall/spool_no_only",
		                    parameterMap: function(data, type){		                    	
						      	data['plant_no'] = dataItem.plant_no;
						      	data['area_no'] = dataItem.area_no;
						      	data['drawing_no'] = dataItem.drawing_no;
						      	data['sheet_no'] = dataItem.sheet_no;
						      	data['rev_no'] = dataItem.rev_no;
		                    	return data; 
		                    }
		                },
		                schema: {
		                    data: function(data) {
		                        return data.rows || [];
		                    }
		                }
		            }
		        }).data("kendoDropDownList");
		        var item_code = $("#item_code").kendoComboBox({
		            filter: "contains",
		            placeholder: "Select Item...",
		            dataTextField: "item_code",
		            dataValueField: "description",
		            dataSource: {
		                transport: {
		                    read: crudService + "directCall/item"
		                },
		                schema: {
		                    data: function(data) {
		                        return data.rows || [];
		                    }
		                }
		            },
	                change: function(e){
	                	$("#desc").val(item_code.value());
	                }
		        }).data("kendoComboBox");
		        if (!e.model.id) {
		            $(e.container).parent().find('.k-window-title').html("Add Random Spool");
		            $(e.container).parent().find('.k-grid-update').html("Save");
		    		$.each($(e.container).find("input"), function(index, value){
		    			if (index <= 4)
		    				$(this).val(eval("dataItem." + this.id)).attr("disabled",true).addClass('k-state-disabled');
		    		});
		        }else{
		        	if (cMode == "edit"){
			            $(e.container).parent().find('.k-window-title').html("Edit Random Spool");
			    		$.each($(e.container).find("input"), function(index, value){
			    			if (index <= 4)
			    				$(this).attr("disabled",true).addClass('k-state-disabled');
			    		});
			        	$(e.container).find("input").eq(5).select().focus();
			        }else
			    		$.each($(e.container).find("input"), function(index, value){
			    			$(this).attr("disabled",true).addClass('k-state-disabled');
			    		});
		        }
		    },
			save: function(e) {
			    if (!confirm("Are you sure you want to save all changes?")) {
			        e.preventDefault();
			    }
			    
				$("#random_rs").data("kendoGrid").setDataSource(random_ds);
				$("#random_rs").data("kendoGrid").dataSource.page($("#random_rs").data("kendoGrid").dataSource.page());
				$("#random_rs").data("kendoGrid").dataSource.read();
			},
			remove: function(e) {
			    if (!confirm("Are you sure you want to delete this record?\n Item: " + e.model.item_code)) {
			        e.preventDefault();
			    }
				$("#random_rs").data("kendoGrid").setDataSource(random_ds);
				$("#random_rs").data("kendoGrid").dataSource.page($("#random_rs").data("kendoGrid").dataSource.page());
				$("#random_rs").data("kendoGrid").dataSource.read();
			},
            toolbar: [
	            {
				    text: "Add",
				    className: "k-grid-add",
				    imageClass: "k-icon k-add"
				},
				{
				    text: "Edit",
				    className: "k-grid-edit",
				    imageClass: "k-icon k-edit"
				},
				{
				    text: "Delete",
				    className: "k-grid-delete",
				    imageClass: "k-icon k-delete"
				},
				{
				    text: "View",
				    className: "k-grid-view",
				    imageClass: "k-icon k-edit"
				},"save","cancel"
			],
            filterable: {
                extra: false
            },
            columns: [
               {field: "item_code",title: "Item Code",width: 90},
               {field: "length",title: "Length (mtr)",width: 105},
               {field: "random_qty",title: "Random Qty",width: 104}
           ],
           change: function(e){
           		currRow = this;
			    var selectedRows = this.select();
			    var selectedDataItems = [];
			    for (var i = 0; i < selectedRows.length; i++) {
			        dataItem = this.dataItem(selectedRows[i]);
			    }
           },
           dataBound: addExtraStylingToGrid_random
        });
        var toggleButt_random = function(vis){
	        $.each($("#random_rs .k-grid-toolbar").find("a"),function(index, value){
	        	eval("$(this)." + ((index <= 3) ? vis : ((vis == "show") ? "hide" : "show")) + "();")
	        });
	    }
	    toggleButt_random("show");
        
        var material_ds = new kendo.data.DataSource({
            transport: {
                read: {
                    url: crudService + "directCall/material",
                    contentType: "application/json",
                    type: "GET"
                },
                create: {
                    url: crudService + "manage/material",
                    type: "POST"
                },
                update: {
                    url: crudService + "manage/material",
                    type: "POST"
                },
                destroy: {
                    url: crudService + "remove/material",
                    type: "POST"
                },
			    parameterMap: function(data, type) {
			      if (type == "read") {
			      	if ($(data.filter).length > 0){
				      	$.each(data.filter.filters,function(index,value){
				      		var valForm = ((typeof this.value) == "object") ? kendo.toString(this.value,"yyyy-MM-dd") : this.value;
				      		filterFArr_material[index] = this.field + ";" + valForm + ";" + this.operator;
				      		filterOArr_material[index] = this.operator;
				      		filterVArr_material[index] = valForm;
				      	});
				    }
			        return {
			            page: data.page,
			            pageSize: data.pageSize,
			            top: data.take,
			            skip: data.skip,
					    fieldF: filterFArr_material,
					    fieldS: ($(data.sort).length ? data.sort[0].field : "area_no"),
					    operator: (($(data.filter).length > 0) ? filterOArr_material : "contains"),
					    value: (($(data.filter).length > 0) ? filterVArr_material : sentValue_spool),
					    dir: ($(data.sort).length ? data.sort[0].dir : "desc"),
					    plant_no: dataItem.plant_no,
					    area_no: dataItem.area_no,
					    drawing_no: dataItem.drawing_no,
					    sheet_no: dataItem.sheet_no,
					    rev_no: dataItem.rev_no
			        }
			      }else{
			      	  data['loguser'] = $("#hidden_user").val();
			      	  data['plant_no'] = dataItem.plant_no;
			      	  data['area_no'] = dataItem.area_no;
			      	  data['drawing_no'] = dataItem.drawing_no;
			      	  data['sheet_no'] = dataItem.sheet_no;
			      	  data['rev_no'] = dataItem.rev_no;
			      	  data['reqd_dt'] = kendo.toString((new Date()),"yyyy-MM-dd");
			      	  data['issueddt'] = kendo.toString((new Date()),"yyyy-MM-dd");
			      	  data['fog_submitt_dt'] = kendo.toString((new Date()),"yyyy-MM-dd");
			      	  data['client_submitted_dt'] = kendo.toString((new Date()),"yyyy-MM-dd");
			      	  return data;
			      }
			    }
            },
            pageSize: 5,
            serverPaging: true,
			serverFiltering: true,
			serverSorting: true,
            schema: {
                data: function(data) {
                    return data.rows || [];
               },
               errors: function(data){
               	// if (filterFArr_random.length > 0 && $(data.rows).length == 0){
               		// alert("No records found!");
					// sentValue_random = "";
					// filterFArr_random = [];
					// $("form.k-filter-menu button[type='reset']").trigger("click");
               		// //grid.data("kendoGrid").dataSource.read();
               	// }

				//alert("Error");
               },
               model: {
               		id: "PROGRESS_RECID",
                    fields: {
                   	    PROGRESS_RECID: {type: "number", editable: false},
                   	    fwbs: {type: "string", editable: false},
                        isc_no: { type: "string"},
                        item_code: { type: "string" },
                   	    spool_no: { type: "string"},
                   	    commodity_code: { type: "string"},
                   	    size: { type: "string"},
                   	    qty: { type: "number"},
                   	    reqd_qty: { type: "number"},
                   	    mrr_qty: { type: "number"},
                   	    mark_no: { type: "string"},
                   	    category: { type: "string"},
                   	    length: { type: "number"},
                   	    lineclass: { type: "string"},
                   	    lineno: { type: "string"},
                   	    painting_specs: { type: "string"},
                   	    testpack_no: { type: "string"},
                   	    logdate: { type: "date"},
                   	    logupdate: { type: "string"},
                   	    loguser: { type: "string"},
                   	    bolt_length: { type: "number"},
                   	    weld_loc: { type: "boolean"},
                   	    reqd_dt: { type: "date"},
                   	    spool_qty: { type: "number"},
                   	    issueddt: { type: "date"},
                   	    fog_submitted_dt: { type: "date"},
                   	    client_submitted_dt: { type: "date"}
                    }
               },
               total: function(response) {
				   	return (($(response.rows[0]).length > 0) ? response.rows[0].total : 0);
			   }
            },
            change: function(e) {
            	if ($(e.items).length == 0)
            		return true;
            		
           		currRow = this;
				var data = e.items[0];
            }
        });    
                                
	    var addExtraStylingToGrid_material = function () {
			$("#material_rs").data("kendoGrid").select("tr:eq(" + ((dataSource._data.length + spool_ds._data.length + joints_ds._data.length + random_ds._data.length) + 5) + ")");
	        $(".k-grid-content > table > tbody > tr").hover(
	            function() {
	                $(this).toggleClass("k-state-hover");
	            }			        
	        );
        	filterFArr_material = [];
	    };
        
        var material_rs = $("#material_rs").kendoGrid({
            dataSource: material_ds,
            selectable: "row",
            autoBind: false,
            pageable: false,
            pageable: {
                buttonCount: 5,
                refresh: true,
                pageSizes: true,
    			input: true
			},
            groupable: false,
            sortable: true,
            scrollable: true,
            navigatable: true,
            resizable: true,
            editable: {
            	mode: "popup",
		        template: $("#_temp_material").html(),
		        update  : true
		    },
		    edit : function (e) {
		        var spool_no = $("#spool_no").kendoDropDownList({
		            filter: "contains",
		            placeholder: "Select Spool...",
		            dataTextField: "spool_no",
		            dataValueField: "spool_no",
		            highlightFirst: true,
		            dataSource: {
		                transport: {
		                    read: crudService + "directCall/spool_no_only",
		                    parameterMap: function(data, type){		                    	
						      	data['plant_no'] = dataItem.plant_no;
						      	data['area_no'] = dataItem.area_no;
						      	data['drawing_no'] = dataItem.drawing_no;
						      	data['sheet_no'] = dataItem.sheet_no;
						      	data['rev_no'] = dataItem.rev_no;
		                    	return data; 
		                    }
		                },
		                schema: {
		                    data: function(data) {
		                        return data.rows || [];
		                    }
		                }
		            }
		        }).data("kendoDropDownList");
		        var item_code = $("#item_code").kendoComboBox({
		            filter: "contains",
		            placeholder: "Select Item...",
		            dataTextField: "item_code",
		            dataValueField: "description",
		            dataSource: {
		                transport: {
		                    read: crudService + "directCall/item"
		                },
		                schema: {
		                    data: function(data) {
		                        return data.rows || [];
		                    }
		                }
		            },
	                change: function(e){
	                	$("#desc").val(item_code.value());
	                }
		        }).data("kendoComboBox");
		        if (!e.model.id) {
		            $(e.container).parent().find('.k-window-title').html("Add Material Take-Off");
		            $(e.container).parent().find('.k-grid-update').html("Save");
		    		$.each($(e.container).find("input"), function(index, value){
		    			if (index <= 4)
		    				$(this).val(eval("dataItem." + this.id)).attr("disabled",true).addClass('k-state-disabled');
		    		});
		        }else {
		        	if (cMode == "edit"){
			            $(e.container).parent().find('.k-window-title').html("Edit Material Take-Off");
			    		$.each($(e.container).find("input"), function(index, value){
			    			if (index <= 4)
			    				$(this).attr("disabled",true).addClass('k-state-disabled');
			    		});
			        	$(e.container).find("input").eq(5).select().focus();
			        }else
			    		$.each($(e.container).find("input"), function(index, value){
			    			$(this).attr("disabled",true).addClass('k-state-disabled');
			    		});
		        }
		    },
			save: function(e) {
			    if (!confirm("Are you sure you want to save all changes?")) {
			        e.preventDefault();
			    }
			    
				$("#random_rs").data("kendoGrid").setDataSource(random_ds);
				$("#random_rs").data("kendoGrid").dataSource.page($("#random_rs").data("kendoGrid").dataSource.page());
				$("#random_rs").data("kendoGrid").dataSource.read();
			},
			remove: function(e) {
			    if (!confirm("Are you sure you want to delete this record?\n Item: " + e.model.item_code)) {
			        e.preventDefault();
			    }
				$("#random_rs").data("kendoGrid").setDataSource(random_ds);
				$("#random_rs").data("kendoGrid").dataSource.page($("#random_rs").data("kendoGrid").dataSource.page());
				$("#random_rs").data("kendoGrid").dataSource.read();
			},
            toolbar: [
	            {
				    text: "Add",
				    className: "k-grid-add",
				    imageClass: "k-icon k-add"
				},
				{
				    text: "Edit",
				    className: "k-grid-edit",
				    imageClass: "k-icon k-edit"
				},
				{
				    text: "Delete",
				    className: "k-grid-delete",
				    imageClass: "k-icon k-delete"
				},
				{
				    text: "View",
				    className: "k-grid-view",
				    imageClass: "k-icon k-edit"
				},"save","cancel"
			],
            filterable: {
                extra: false
            },
            columns: [
               {field: "fwbs",title: "FWBS",width: 90},
               {field: "isc_no",title: "Item #",width: 90},
               {field: "item_code",title: "Item Code",width: 120},
               {field: "spool_no",title: "Spool No",width: 88},
               {field: "commodity_code",title: "Commodity Code",width: 133},
               {field: "size",title: "Size",width: 97},
               {field: "qty",title: "Quantity",width: 88},
               {field: "reqd_qty",title: "Requested",width: 95},
               {field: "mrr_qty",title: "MRR Qty",width: 82},
               {field: "mark_no",title: "Material #",width: 88},
               {field: "category",title: "Category",width: 90},
               {field: "length",title: "Length",width: 88},
               {field: "lineclass",title: "Line Class",width: 91},
               {field: "lineno",title: "Line No",width: 90},
               {field: "painting_specs",title: "Painting Specs",width: 120},
               {field: "testpack_no",title: "TestPack No",width: 124},
               {field: "logdate",title: "Log Date",width: 90, format: "{0:MM/dd/yyyy}"},
               {field: "logupdate",title: "Log Update",width: 101, format: "{0:MM/dd/yyyy}"},
               {field: "loguser",title: "Log User",width: 88},
               {field: "bolt_length",title: "Bolt Length",width: 96},
               {field: "weld_loc",title: "Location",width: 180},
               {field: "reqd_dt",title: "Required Date",width: 115, format: "{0:MM/dd/yyyy}"},
               {field: "spool_qty",title: "Spool Qty",width: 90},
               {field: "issueddt",title: "Issued Date",width: 106, format: "{0:MM/dd/yyyy}"},
               {field: "fog_submitted_dt",title: "FOG Sub. Date",width: 117, format: "{0:MM/dd/yyyy}"},
               {field: "client_submitted_dt",title: "Client Sub. Date",width: 129, format: "{0:MM/dd/yyyy}"}
           ],
           change: function(e){
           		currRow = this;
			    var selectedRows = this.select();
			    var selectedDataItems = [];
			    for (var i = 0; i < selectedRows.length; i++) {
			        dataItem = this.dataItem(selectedRows[i]);
			    }
           },
           dataBound: addExtraStylingToGrid_material
        });

        var toggleButt_material = function(vis){
	        $.each($("#material_rs .k-grid-toolbar").find("a"),function(index, value){
	        	//alert("$(this)." + ((index <= 2) ? vis : ((vis == "show") ? "hide" : "show")) + "();");
	        	eval("$(this)." + ((index <= 3) ? vis : ((vis == "show") ? "hide" : "show")) + "();")
	        });
	    }
	    toggleButt_material("show");
						
        $("#takeOff_ts").kendoTabStrip({
        	activate: function(e){
        		var tabStrip = $("#takeOff_ts").data("kendoTabStrip");
        		if ($('ul.k-tabstrip-items > li').index($("li.k-state-active")) == 0)
        			spool_ds.read();
        		else
        			material_ds.read();
        		//alert(tabStrip.select());
        		//console.log();
        	},
            animation:  {
                open: {
                    effects: "fadeIn"
                }
            }
        });  
		
        var addNewRow = function (id) {
		    $(id).data("kendoGrid").addRow();
		}
			
		var editSelectedRow = function(id) {
		    $(id).data("kendoGrid").editRow($(id).data("kendoGrid").select());
		}
			
		var removeSelectedRow = function(id) {
		    $(id).data("kendoGrid").removeRow($(id).data("kendoGrid").select());
		    $(id).data("kendoGrid").dataSource.read();

		}
			
	    $(".k-grid-toolbar .k-grid-add").on("click", function (e) {
	        e.preventDefault();
	        cMode = "add";
	        addNewRow("#" + $(this).parent().parent()[0].id);
	    });
			
	    $(".k-grid-toolbar .k-grid-edit").on("click", function (e) {
	        e.preventDefault();
	        cMode = "edit";
	        editSelectedRow("#" + $(this).parent().parent()[0].id);
	    });
			
	    $(".k-grid-toolbar .k-grid-delete").on("click", function (e) {
	        e.preventDefault();
	        removeSelectedRow("#" + $(this).parent().parent()[0].id);
	    });
			
	    $(".k-grid-toolbar .k-grid-view").on("click", function (e) {
	        e.preventDefault();
	        cMode = "view";
	        editSelectedRow("#" + $(this).parent().parent()[0].id);
	    });
			
	    $(".k-grid-toolbar .k-grid-viewAtt").on("click", function (e) {
	        e.preventDefault();
	        cMode = "viewAtt";
	        editSelectedRow("#" + $(this).parent().parent()[0].id);
	    });
	});
</script>